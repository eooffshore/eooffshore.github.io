
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Comparison of Offshore Wind Speed Extrapolation and Power Density Estimation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}})</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="canonical" href="https://eooffshore.github.io/Comparison_Wind_Power.html" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Wind Atlas Development" href="windatlas.html" />
    <link rel="prev" title="Offshore Wind in Irish Areas Of Interest" href="Offshore_Wind_AOI.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/eooffshore_banner.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  EOOffshore
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="project_overview.html">
   Project Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="approach.html">
   Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="acknowledgements.html">
   Acknowledgements
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Wind Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="datasets.html">
   Irish Continental Shelf Data Sets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ASCAT_ICS_Wind_Data.html">
     ASCAT Wind Data for Irish Continental Shelf region
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="CCMP_ICS_Wind_Data.html">
     CCMP Wind Data for Irish Continental Shelf region
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ERA5_ICS_Wind_Data.html">
     ERA5 Wind Data for Irish Continental Shelf region
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="MERA_ICS_Wind_Data.html">
     MÉRA Wind Data for Irish Continental Shelf region
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="NEWA_ICS_Wind_Data.html">
     NEWA Wind Data for Irish Continental Shelf region
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Sentinel-1_ICS_Wind_Data.html">
     Sentinel-1 Wind Data for Irish Continental Shelf region
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Area Of Interest Assessment
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Offshore_Wind_AOI.html">
   Offshore Wind in Irish Areas Of Interest
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Comparison of Offshore Wind Speed Extrapolation and Power Density Estimation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Offshore Wind Atlases
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="windatlas.html">
   Wind Atlas Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MERA_ICS_Wind_Atlas.html">
   MÉRA-based Wind Atlas for Irish Continental Shelf region
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Comparison_Wind_Power.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Comparison_Wind_Power.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-eooffshore-catalog-data">
   Load EOOffshore Catalog Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-the-catalog">
     Open the catalog
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-catalog-zarr-stores">
     Load the catalog Zarr stores
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-ascat-reprocessed-store">
       Load the ASCAT REProcessed store
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-ccmp-store">
       Load the CCMP store
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-era5-store">
       Load the ERA5 store
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-mera-store">
       Load the MÉRA store
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-newa-stores">
       Load the NEWA stores
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-sentinel-1-store">
       Load the Sentinel-1 store
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-aoi-catalog-data">
     Load AOI catalog data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-irish-weather-buoy-network-data">
       Load the Irish Weather Buoy Network data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-synthentic-wind-farm-shapefile">
       Load the synthentic wind farm shapefile
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparison-of-in-situ-buoy-and-data-set-wind-speed">
   Comparison of In situ Buoy and Data Set Wind Speed
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparison-metrics">
     Comparison metrics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wind-speed-summary">
     Wind speed summary
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iwb-wind-speed-comparison-with-data-sets">
     IWB wind speed comparison with data sets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-sets-wind-speed-comparison">
   Data Sets Wind Speed Comparison
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#m-wind-speed">
     10m wind speed
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mera-10m-wind-speed">
       MÉRA 10m wind speed
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#newa-10m-wind-speed">
       NEWA 10m wind speed
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wind-speed-extrapolation">
   Wind Speed Extrapolation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#power-law-extrapolation">
     Power law extrapolation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mera-125m-wind-speed-comparison">
       MÉRA 125m wind speed comparison
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#newa-150m-wind-speed-comparison">
       NEWA 150m wind speed comparison
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#power-law-alpha-estimation">
       Power law
       <span class="math notranslate nohighlight">
        \(\alpha\)
       </span>
       estimation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mera-125m-wind-speed-comparison-using-era5-power-law-alpha">
       MÉRA 125m wind speed comparison using ERA5 power law
       <span class="math notranslate nohighlight">
        \(\alpha\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#newa-150m-wind-speed-comparison-using-era5-power-law-alpha">
       NEWA 150m wind speed comparison using ERA5 power law
       <span class="math notranslate nohighlight">
        \(\alpha\)
       </span>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#log-law-extrapolation">
     Log law extrapolation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       MÉRA 125m wind speed comparison
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       NEWA 150m wind speed comparison
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extrapolation-metrics-review">
     Extrapolation metrics review
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power-density-estimation">
   Power Density Estimation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimation-implementation">
     Estimation implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#power-density-estimation-using-cubed-wind-speed">
     Power Density Estimation using cubed wind speed
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aoi-wind-speed-distributions-and-weibull-parameters">
     AOI wind speed distributions and Weibull parameters
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power-density-comparison">
   Power Density Comparison
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#newa-150m-power-density">
     NEWA 150m power density
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Comparison of Offshore Wind Speed Extrapolation and Power Density Estimation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-eooffshore-catalog-data">
   Load EOOffshore Catalog Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#open-the-catalog">
     Open the catalog
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-the-catalog-zarr-stores">
     Load the catalog Zarr stores
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-ascat-reprocessed-store">
       Load the ASCAT REProcessed store
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-ccmp-store">
       Load the CCMP store
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-era5-store">
       Load the ERA5 store
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-mera-store">
       Load the MÉRA store
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-newa-stores">
       Load the NEWA stores
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-sentinel-1-store">
       Load the Sentinel-1 store
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-aoi-catalog-data">
     Load AOI catalog data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-irish-weather-buoy-network-data">
       Load the Irish Weather Buoy Network data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-the-synthentic-wind-farm-shapefile">
       Load the synthentic wind farm shapefile
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparison-of-in-situ-buoy-and-data-set-wind-speed">
   Comparison of In situ Buoy and Data Set Wind Speed
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparison-metrics">
     Comparison metrics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#wind-speed-summary">
     Wind speed summary
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iwb-wind-speed-comparison-with-data-sets">
     IWB wind speed comparison with data sets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-sets-wind-speed-comparison">
   Data Sets Wind Speed Comparison
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#m-wind-speed">
     10m wind speed
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mera-10m-wind-speed">
       MÉRA 10m wind speed
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#newa-10m-wind-speed">
       NEWA 10m wind speed
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wind-speed-extrapolation">
   Wind Speed Extrapolation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#power-law-extrapolation">
     Power law extrapolation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mera-125m-wind-speed-comparison">
       MÉRA 125m wind speed comparison
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#newa-150m-wind-speed-comparison">
       NEWA 150m wind speed comparison
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#power-law-alpha-estimation">
       Power law
       <span class="math notranslate nohighlight">
        \(\alpha\)
       </span>
       estimation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mera-125m-wind-speed-comparison-using-era5-power-law-alpha">
       MÉRA 125m wind speed comparison using ERA5 power law
       <span class="math notranslate nohighlight">
        \(\alpha\)
       </span>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#newa-150m-wind-speed-comparison-using-era5-power-law-alpha">
       NEWA 150m wind speed comparison using ERA5 power law
       <span class="math notranslate nohighlight">
        \(\alpha\)
       </span>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#log-law-extrapolation">
     Log law extrapolation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       MÉRA 125m wind speed comparison
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       NEWA 150m wind speed comparison
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extrapolation-metrics-review">
     Extrapolation metrics review
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power-density-estimation">
   Power Density Estimation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimation-implementation">
     Estimation implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#power-density-estimation-using-cubed-wind-speed">
     Power Density Estimation using cubed wind speed
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aoi-wind-speed-distributions-and-weibull-parameters">
     AOI wind speed distributions and Weibull parameters
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#power-density-comparison">
   Power Density Comparison
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#newa-150m-power-density">
     NEWA 150m power density
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a class="reference internal" href="_images/eooffshore_banner.png"><img alt="_images/eooffshore_banner.png" src="_images/eooffshore_banner.png" style="width: 48%;" /></a> </p>
<p><a class="reference internal" href="_images/seai.png"><img alt="_images/seai.png" src="_images/seai.png" style="width: 25%;" /></a> <span /> <a class="reference internal" href="_images/ucd.png"><img alt="_images/ucd.png" src="_images/ucd.png" style="width: 7%;" /></a></p>
<section id="comparison-of-offshore-wind-speed-extrapolation-and-power-density-estimation">
<h1>Comparison of Offshore Wind Speed Extrapolation and Power Density Estimation<a class="headerlink" href="#comparison-of-offshore-wind-speed-extrapolation-and-power-density-estimation" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This notebook demonstrates the utility of the <a class="reference external" href="https://pangeo.io/">Pangeo</a> software ecosystem in the comparison of methods for offshore wind speed extrapolation and power density estimation, increasing wind measurement coverage of offshore renewable energy assessment areas in the <a class="reference external" href="https://www.marine.ie/Home/site-area/irelands-marine-resource/real-map-ireland">Irish Continental Shelf (ICS)</a> region. It uses the EOOffshore wind data catalog created for this region, consisting of a collection of analysis-ready, cloud-optimized (ARCO) datasets featuring up to 21 years of available in situ, reanalysis, and satellite observation wind data products. Scalable processing and visualization of this ARCO catalog is demonstrated with analysis of provided data variables and derivation of new variables as required for AOIs, avoiding redundant storage and processing requirements for areas not under assessment. The notebook findings are used for AOI assessment described in the accompanying <a class="reference internal" href="Offshore_Wind_AOI.html"><span class="doc std std-doc">Offshore Wind in Irish Areas Of Interest</span></a> notebook.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Data</p></th>
<th class="head"><p>Provider</p></th>
<th class="head"><p>Time</p></th>
<th class="head"><p># Products</p></th>
<th class="head"><p>Products Size (GB)</p></th>
<th class="head"><p>ARCO Zarr (GB)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://resources.marine.copernicus.eu/product-detail/WIND_GLO_WIND_L3_NRT_OBSERVATIONS_012_002">ASCAT Near Real Time L3 Sea Winds</a></p></td>
<td><p><a class="reference external" href="https://marine.copernicus.eu/">Copernicus Marine Service</a></p></td>
<td><p>2016-01 to 2021-09</p></td>
<td><p>324</p></td>
<td><p>16</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://resources.marine.copernicus.eu/product-detail/WIND_GLO_WIND_L3_REP_OBSERVATIONS_012_005">ASCAT Reprocessed L3 Sea Winds</a></p></td>
<td><p><a class="reference external" href="https://marine.copernicus.eu/">Copernicus Marine Service</a></p></td>
<td><p>2007-01 to 2021-07</p></td>
<td><p>412</p></td>
<td><p>21</p></td>
<td><p>14</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="http://www.remss.com/measurements/ccmp/">CCMP Wind V2.1 NRT</a></p></td>
<td><p><a class="reference external" href="http://www.remss.com">Remote Sensing Systems</a></p></td>
<td><p>2015-01 to 2021-09</p></td>
<td><p>2,436</p></td>
<td><p>109</p></td>
<td><p>0.5</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp##%21/dataset/reanalysis-era5-single-levels">ERA5 Hourly Single Level</a></p></td>
<td><p><a class="reference external" href="https://climate.copernicus.eu/">Copernicus Climate Change Service</a></p></td>
<td><p>2001-01 to 2021-09</p></td>
<td><p>249</p></td>
<td><p>10</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.met.ie/climate/available-data/mera">Met Éireann Re-Analysis (MÉRA)</a></p></td>
<td><p><a class="reference external" href="https://www.met.ie/about-us">Met Éireann</a></p></td>
<td><p>2001-01 to 2016-12</p></td>
<td><p>1,920</p></td>
<td><p>226</p></td>
<td><p>196</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://sentinel.esa.int/web/sentinel/technical-guides/sentinel-1-sar/products-algorithms/level-2-algorithms">Sentinel-1 L2 OCN</a></p></td>
<td><p><a class="reference external" href="https://scihub.copernicus.eu/">Copernicus Open Access Hub</a>; <a class="reference external" href="https://asf.alaska.edu/">Alaska Satellite Facility</a></p></td>
<td><p>2015-06 to 2021-09</p></td>
<td><p>17,698</p></td>
<td><p>241</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="http://www.marine.ie/Home/site-area/data-services/real-time-observations/irish-weather-buoy-network-imos">Irish Weather Buoy Network</a></p></td>
<td><p><a class="reference external" href="https://www.marine.ie/Home/home">Marine Institute</a></p></td>
<td><p>2001-05 to 2021-09</p></td>
<td><p>1</p></td>
<td><p>0.08</p></td>
<td><p>n/a</p></td>
</tr>
</tbody>
</table>
<p>The following sections describe:</p>
<ol class="simple">
<li><p>EOOffshore catalog data sets loading. Catalog creation is described in the following notebooks:</p>
<ul class="simple">
<li><p><a class="reference internal" href="ASCAT_ICS_Wind_Data.html"><span class="doc std std-doc">ASCAT Wind Data for Irish Continental Shelf region</span></a></p></li>
<li><p><a class="reference internal" href="CCMP_ICS_Wind_Data.html"><span class="doc std std-doc">CCMP Wind Data for Irish Continental Shelf region</span></a></p></li>
<li><p><a class="reference internal" href="ERA5_ICS_Wind_Data.html"><span class="doc std std-doc">ERA5 Wind Data for Irish Continental Shelf region</span></a></p></li>
<li><p><a class="reference internal" href="MERA_ICS_Wind_Data.html"><span class="doc std std-doc">MÉRA Wind Data for Irish Continental Shelf region</span></a></p></li>
<li><p><a class="reference internal" href="NEWA_ICS_Wind_Data.html"><span class="doc std std-doc">NEWA Wind Data for Irish Continental Shelf region</span></a></p></li>
<li><p><a class="reference internal" href="Sentinel-1_ICS_Wind_Data.html"><span class="doc std std-doc">Sentinel-1 Wind Data for Irish Continental Shelf region</span></a></p></li>
</ul>
</li>
<li><p>Comparison of in situ buoy and catalog wind speed.</p></li>
<li><p>Comparison of wind speeds provided by the catalog data sets.</p></li>
<li><p>Methods for extrapolation of catalog wind speed to typical <a class="reference external" href="https://www.wind-energy-the-facts.org/hub-height.html">wind turbine hub heights</a>.</p></li>
<li><p>Extrapolation of catalog wind speed to typical <a class="reference external" href="https://www.wind-energy-the-facts.org/hub-height.html">wind turbine hub heights</a>.</p></li>
<li><p>Wind power density estimates comparison with provided data.</p></li>
</ol>
<p><strong>How to cite:</strong> O’Callaghan, D. and McBreen, S.: Scalable Offshore Wind Analysis With Pangeo, EGU General Assembly 2022, Vienna, Austria, 23–27 May 2022, EGU22-2746, <a class="reference external" href="https://doi.org/10.5194/egusphere-egu22-2746">https://doi.org/10.5194/egusphere-egu22-2746</a>, 2022.</p>
</section>
<hr class="docutils" />
<section id="load-eooffshore-catalog-data">
<h2>Load EOOffshore Catalog Data<a class="headerlink" href="#load-eooffshore-catalog-data" title="Permalink to this headline">¶</a></h2>
<p>Imports required for subsequent processing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">da</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">intake</span> <span class="kn">import</span> <span class="n">Catalog</span><span class="p">,</span> <span class="n">open_catalog</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">metpy.units</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">regionmask</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interpn</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span><span class="p">,</span> <span class="n">weibull_min</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;axes.labelcolor&#39;</span><span class="p">:</span> <span class="s1">&#39;0 &#39;</span><span class="p">,</span> <span class="s2">&quot;text.color&quot;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;xtick.color&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;ytick.color&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;font.sans-serif&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span> <span class="s1">&#39;Liberation Sans&#39;</span><span class="p">,</span> <span class="s1">&#39;Bitstream Vera Sans&#39;</span><span class="p">,</span> <span class="s1">&#39;sans-serif&#39;</span><span class="p">],})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s1">&#39;notebook&#39;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<section id="open-the-catalog">
<h3>Open the catalog<a class="headerlink" href="#open-the-catalog" title="Permalink to this headline">¶</a></h3>
<p>All EOOffshore data sets, for example, the <a class="reference internal" href="ERA5_ICS_Wind_Data.html"><span class="doc std std-doc">ERA5 Zarr store</span></a>, are accessible using the EOOffshore <a class="reference external" href="https://intake.readthedocs.io/en/latest/">Intake</a> catalog. Each <a class="reference external" href="https://intake.readthedocs.io/en/latest/catalog.html">catalog</a> entry provides a description and metadata associated with the corresponding data set, defined in a <a class="reference external" href="https://intake.readthedocs.io/en/latest/catalog.html#yaml-format">YAML configuration file</a>. The EOOffshore catalog configuration was originally influenced by the <a class="reference external" href="https://github.com/pangeo-data/pangeo-datastore/blob/master/intake-catalogs/atmosphere.yaml">Pangeo Cloud Data Store atmosphere.yaml catalog configuration</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span> <span class="o">=</span> <span class="n">open_catalog</span><span class="p">(</span><span class="s1">&#39;data/intake-catalogs/eooffshore_ics.yaml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="load-the-catalog-zarr-stores">
<h3>Load the catalog Zarr stores<a class="headerlink" href="#load-the-catalog-zarr-stores" title="Permalink to this headline">¶</a></h3>
<p>Intake catalog entries typically specify a <a class="reference external" href="https://intake.readthedocs.io/en/latest/catalog.html#driver-selection">driver</a> to be used when loading the corresponding data set. The ASCAT entries specify <a class="reference external" href="https://intake-xarray.readthedocs.io/en/latest/api.html#intake_xarray.xzarr.ZarrSource"><code class="docutils literal notranslate"><span class="pre">intake_xarray.xzarr.ZarrSource</span></code></a>, a driver implementation provided by the <a class="reference external" href="https://intake-xarray.readthedocs.io/">intake-xarray</a> library. This enables NetCDF and Zarr data sets to be loaded using <a class="reference external" href="https://docs.xarray.dev/en/stable/index.html">xarray</a>, a library for processing N-D labeled arrays and datasets. As xarray labels take the form of dimensions, coordinates and attributes on top of <a class="reference external" href="https://numpy.org/">NumPy</a>-like arrays, it is particularly suited to data sets such as ASCAT whose variables feature latitude/longitude grid coordinates.</p>
<p>This intake driver will load the associated dataset into an <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html"><code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code></a>. To enable support for potentially large data sets, the <a class="reference external" href="https://intake.readthedocs.io/en/latest/quickstart.html#working-with-dask"><code class="docutils literal notranslate"><span class="pre">to_dask()</span></code></a> function is used to load the underlying variable arrays with <a class="reference external" href="https://docs.dask.org/en/latest/">Dask</a>, a parallel, out-of-core computing library. The <a class="reference external" href="https://intake-xarray.readthedocs.io/en/latest/api.html#intake_xarray.xzarr.ZarrSource"><code class="docutils literal notranslate"><span class="pre">ZarrSource</span></code></a> implementation will load the data set variables into <a class="reference external" href="https://docs.dask.org/en/latest/array.html">Dask arrays</a>, which will be loaded and processed in parallel as <a class="reference external" href="https://docs.dask.org/en/latest/array.html">chunks</a> during subsequent computation. Variable chunk sizes have been specified during Zarr store creation.</p>
<p>Here, a number of utility classes are created to enable processing of catalog entries throughout the notebook:</p>
<ol class="simple">
<li><p>All data sets are loaded by an <code class="docutils literal notranslate"><span class="pre">EooffshoreDataset</span></code> instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">XarrayEooffshoreDataset</span></code> supports Zarr store data sets:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://intake.readthedocs.io/en/latest/quickstart.html#working-with-dask"><code class="docutils literal notranslate"><span class="pre">to_dask()</span></code></a> loads the store</p></li>
<li><p>Variables are renamed if required, ensuring consistent names for all data sets, for example, <code class="docutils literal notranslate"><span class="pre">wind_speed</span></code> and <code class="docutils literal notranslate"><span class="pre">wind_direction</span></code>.</p></li>
<li><p>Longitude rotation from [0, 360] to [-180, 180] is performed if required</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">CurvilinearEooffshoreDataset</span></code> supports Zarr stores featuring two-dimensional curvilinear grids:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.DataArray.sel.html"><code class="docutils literal notranslate"><span class="pre">xarray.DataArray.sel(...,</span> <span class="pre">method='nearest')</span></code></a> does not support selection from two-dimensional curvilinear grids, for example, using latitude/longitude coordinates</p></li>
<li><p>Two-dimenional grid selection is enabled by the use of a K-Nearest Neighbours (kNN) learner from <a class="reference external" href="https://scikit-learn.org/stable/index.html">scikit-learn</a> (<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.NearestNeighbors.html"><code class="docutils literal notranslate"><span class="pre">sklearn.neighbors.NearestNeighbors</span></code></a>), which is fit with the grid coordinates when the Zarr store is loaded. To match the behaviour of <a class="reference external" href="https://docs.xarray.dev/en/stable/generated/xarray.DataArray.sel.html"><code class="docutils literal notranslate"><span class="pre">xarray.DataArray.sel(...,</span> <span class="pre">method='nearest')</span></code></a>, <code class="docutils literal notranslate"><span class="pre">k</span></code> is set to 1 to return the nearest coordinates to the specified parameters.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">NewaOffshoreDataset</span></code> supports the multiple AOI NEWA Zarr stores contained in the catalog, as described in the <a class="reference internal" href="NEWA_ICS_Wind_Data.html"><span class="doc std std-doc">NEWA Wind Data for Irish Continental Shelf region</span></a> notebook.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WindfarmEooffshoreDataset</span></code> provides access to a synthetic wind farm AOI data set created for the EOOffshore project, and functionality for selecting corresponding data subsets from the Zarr stores, using <a class="reference external" href="https://geopandas.org/en/stable/">GeoPandas</a> and <a class="reference external" href="https://regionmask.readthedocs.io">regionmask</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IwbEooffshoreDataset</span></code> provides access to an EOffshore data set containing observations from the <a class="reference external" href="http://www.marine.ie/Home/site-area/data-services/real-time-observations/irish-weather-buoy-network-imos">Irish Weather Buoy Network</a>, and functionality for selecting corresponding data subsets from the Zarr stores.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">EooffshoreDataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base EOOffshore dataset class, associated with a single Intake Catalog entry&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="c1"># Short name used in plots</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="n">Catalog</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dataset_id</span><span class="p">:</span> <span class="nb">str</span> <span class="c1"># Catalog identifier</span>
    <span class="n">round_test_dataset_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">aoi_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve dataset subset for specified area of interest if required&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">XarrayEooffshoreDataset</span><span class="p">(</span><span class="n">EooffshoreDataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dataset backed by a Zarr store, NetCDF file etc.&quot;&quot;&quot;</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">rename_variables</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">rotate_longitude</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Rotate from [0, 360] to [-180, 180]</span>
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the dataset from the Intake catalog, and perform some common initialisation&quot;&quot;&quot;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">]</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span>
        
        <span class="c1"># Enable consistent variable naming</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_variables</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rename_variables</span><span class="p">)</span>
            
        <span class="c1"># Add a &#39;Season&#39; coordinate derived from the &#39;time&#39; coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;Season&#39;</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span><span class="p">})</span>
           
    <span class="k">def</span> <span class="nf">sel_grid_nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select a subset of the dataset, nearest to the specified coordinates&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_longitude</span><span class="p">:</span>
            <span class="n">longitude</span> <span class="o">%=</span> <span class="mi">360</span>     
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nearest_latitude_longitude</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_nearest_latitude_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select a subset of the associated 1-D grid dataset, nearest to the specified coordinates&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CurvilinearEooffshoreDataset</span><span class="p">(</span><span class="n">XarrayEooffshoreDataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Additional functionality to handle issue where `xarray.Dataset.sel()` doesn&#39;t support calls to sel() for 2-D latitude/longitude grids. </span>
<span class="sd">    This is enabled by the use of a K-Nearest Neighbours (kNN) learner</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">grid_neighbours</span><span class="p">:</span> <span class="n">NearestNeighbors</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fit nearest neighbours learner using dataset latitude/longitude grid, used in subsequent calls to sel()&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>
        
        <span class="n">longitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">longitude</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">latitude</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_neighbours</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,),</span> <span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_nearest_latitude_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select a subset of the associated 2-D grid dataset, using the top kNN (k=1) neighbours to the specified coordinates&quot;&quot;&quot;</span>
        <span class="c1"># Select one neighbour similar to `xarray.Dataset.sel(..., method=&#39;nearest&#39;)`</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_neighbours</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
        <span class="n">yindex</span><span class="p">,</span> <span class="n">xindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ydim</span><span class="p">,</span> <span class="n">xdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">dims</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="n">ydim</span><span class="p">:</span> <span class="n">yindex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">xdim</span><span class="p">:</span> <span class="n">xindex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]})</span>

        
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NewaEooffshoreDataset</span><span class="p">(</span><span class="n">EooffshoreDataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Additional functionality required for processing NEWA datasets. It acts as a mapper from AOI to underlying `xarray.Dataset`&quot;&quot;&quot;</span> 
    <span class="n">aoi_mapping</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">datasets</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">CurvilinearEooffshoreDataset</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Preprocessing of the datasets loaded from the Intake catalog&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="p">{</span><span class="n">aoi</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_newa_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">dataset_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">aoi_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aoi</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EooffshoreDataset</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Retrieve dataset subset for area of interest&quot;&quot;&quot;</span>
        <span class="n">aoids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">aoi</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">aoids</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@lru_cache</span>
    <span class="k">def</span> <span class="nf">_load_newa_dataset</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads Zarr store associated with an AOI&quot;&quot;&quot;</span>
        <span class="n">newa_ds</span> <span class="o">=</span> <span class="n">CurvilinearEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> 
                                               <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> 
                                               <span class="n">dataset_id</span><span class="o">=</span><span class="n">dataset_id</span><span class="p">,</span>
                                               <span class="n">rename_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;WS&#39;</span><span class="p">:</span> <span class="s1">&#39;wind_speed&#39;</span><span class="p">,</span> 
                                                                 <span class="s1">&#39;WD&#39;</span><span class="p">:</span> <span class="s1">&#39;wind_direction&#39;</span><span class="p">,</span> 
                                                                 <span class="s1">&#39;PD&#39;</span><span class="p">:</span> <span class="s1">&#39;power_density&#39;</span><span class="p">,</span> 
                                                                 <span class="s1">&#39;XLAT&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> 
                                                                 <span class="s1">&#39;XLON&#39;</span><span class="p">:</span> <span class="s1">&#39;longitude&#39;</span><span class="p">}</span>
                                              <span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">newa_ds</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;south_north&#39;</span><span class="p">,</span> <span class="s1">&#39;west_east&#39;</span><span class="p">])</span>

        <span class="c1"># Add provided 10m wind variable data to corresponding variable with a height dimension</span>
        <span class="n">wind_variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">variable_name_10m</span><span class="p">,</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;WS10&#39;</span><span class="p">:</span> <span class="s1">&#39;wind_speed&#39;</span><span class="p">,</span> <span class="s1">&#39;WD10&#39;</span><span class="p">:</span> <span class="s1">&#39;wind_direction&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
            <span class="n">wind_variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">],</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable_name_10m</span><span class="p">]</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="s1">&#39;height&#39;</span><span class="p">])),</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">reindex</span><span class="p">({</span><span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">wind_variables</span><span class="p">[</span><span class="s1">&#39;wind_speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">})</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">wind_variable</span> <span class="ow">in</span> <span class="n">wind_variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_variable</span>
        
        <span class="n">newa_ds</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span>
        <span class="k">return</span> <span class="n">newa_ds</span>
    
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">WindfarmEooffshoreDataset</span><span class="p">(</span><span class="n">EooffshoreDataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wind farm location shapefile dataset&quot;&quot;&quot;</span>
    <span class="n">dataframe</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">windfarms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="n">windfarm_mask</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">selection_buffer</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the wind farm dataset from the catalog shapefile, and create a corresponding mask used for subsequent dataset subset selection&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">]</span><span class="o">.</span><span class="n">urlpath</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">windfarms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">windfarms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windfarms</span><span class="p">)]</span>
        
        <span class="c1"># Higher-resolution mask that&#39;s used when dataset mask is insufficient during subsequent windfarm AOI retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windfarm_mask</span> <span class="o">=</span> <span class="n">regionmask</span><span class="o">.</span><span class="n">mask_geopandas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">.</span><span class="mi">007</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">55.42</span><span class="p">,</span> <span class="mf">51.0</span><span class="p">,</span> <span class="o">-.</span><span class="mi">007</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="s1">&#39;longitude&#39;</span><span class="p">})</span>
        
    <span class="k">def</span> <span class="nf">windfarm_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">windfarm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">XarrayEooffshoreDataset</span><span class="p">,</span> <span class="n">spatial_mean</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Select a dataset subset for the specified wind farm, using the wind farm dataset mask&quot;&quot;&quot;</span>
        <span class="n">windfarm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">Name</span><span class="o">==</span><span class="n">windfarm</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">aoi_dataset</span><span class="p">(</span><span class="n">windfarm</span><span class="p">)</span><span class="o">.</span><span class="n">dataset</span>
    
        <span class="n">dataset_windfarm_mask</span> <span class="o">=</span> <span class="n">regionmask</span><span class="o">.</span><span class="n">mask_geopandas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">lon_name</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">lat_name</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">)</span>

        <span class="c1"># If the wind farm is present in the dataset mask, use that directly</span>
        <span class="c1"># Otherwise find the closest dataset coordinate to the high-res mask wind farm coordinates</span>
        <span class="k">if</span> <span class="n">windfarm_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">dataset_windfarm_mask</span><span class="p">):</span>
            <span class="n">windfarmds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataset_windfarm_mask</span><span class="o">==</span><span class="n">windfarm_id</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">highresmask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">windfarm_mask</span>
            <span class="n">windfarm_lat</span> <span class="o">=</span> <span class="n">highresmask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">highresmask</span><span class="o">==</span><span class="n">windfarm_id</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>
            <span class="n">windfarm_lon</span> <span class="o">=</span> <span class="n">highresmask</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">highresmask</span><span class="o">==</span><span class="n">windfarm_id</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span>
            <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">rotate_longitude</span><span class="p">:</span>
                <span class="n">windfarm_lon</span> <span class="o">%=</span> <span class="mi">360</span>            
            <span class="n">windfarmds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&gt;=</span> <span class="n">windfarm_lat</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_buffer</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">latitude</span> <span class="o">&lt;=</span> <span class="n">windfarm_lat</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_buffer</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&gt;=</span> <span class="n">windfarm_lon</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_buffer</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">longitude</span> <span class="o">&lt;=</span> <span class="n">windfarm_lon</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_buffer</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">spatial_mean</span><span class="p">:</span>
            <span class="c1"># Calculate the mean for all wind farm subset coordinates</span>
            <span class="c1"># Both 1-d and 2-d grid dimensions are supported</span>
            <span class="n">windfarmds</span> <span class="o">=</span> <span class="n">windfarmds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">dims</span><span class="p">),</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">windfarmds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;Windfarm&#39;</span><span class="p">:</span> <span class="n">windfarm</span><span class="p">})</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="s1">&#39;Windfarm&#39;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Buoy</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">longitude</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">latitude</span><span class="p">:</span> <span class="nb">float</span>
    
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IwbEooffshoreDataset</span><span class="p">(</span><span class="n">EooffshoreDataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Irish Weather Buoy dataset&quot;&quot;&quot;</span>
    <span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">buoy_coordinates</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Buoy</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Preprocessing of the data frame loaded from the Intake catalog&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="c1"># Retain only buoys still in use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">station_id</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M3&#39;</span><span class="p">,</span> <span class="s1">&#39;M4&#39;</span><span class="p">,</span> <span class="s1">&#39;M5&#39;</span><span class="p">,</span> <span class="s1">&#39;M6&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;longitude (degrees_east)&#39;</span><span class="p">:</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude (degrees_north)&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;wind_speed3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;WindSpeed (knots)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:(</span><span class="n">x</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">knot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">meter_per_second</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
        
        <span class="c1"># https://stackoverflow.com/questions/62917882/convert-datetime64ns-utc-pandas-column-to-datetime</span>
        <span class="c1"># https://stackoverflow.com/questions/16628819/convert-pandas-timezone-aware-datetimeindex-to-naive-timestamp-but-in-certain-t/62656878#62656878</span>
        <span class="c1"># Subsequent matching isn&#39;t possible if the time type is e.g. datetime64[ns, UTC]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;time (UTC)&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[[</span><span class="s1">&#39;station_id&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;WindDirection (degrees true)&#39;</span><span class="p">,</span> <span class="s1">&#39;wind_speed3&#39;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buoy_coordinates</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">Buoy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">latitude</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;station_id&#39;</span><span class="p">)[[</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;unique&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">buoys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buoy_coordinates</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="k">def</span> <span class="nf">buoy_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buoy</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">XarrayEooffshoreDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Select a dataset subset using the coordinates of the specified buoy AOI&quot;&quot;&quot;</span>
        <span class="n">buoyds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">buoyds</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">aoi_dataset</span><span class="p">(</span><span class="n">aoi</span><span class="o">=</span><span class="n">buoy</span><span class="p">)</span><span class="o">.</span><span class="n">sel_grid_nearest</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">buoy_coordinates</span><span class="p">[</span><span class="n">buoy</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">buoy_coordinates</span><span class="p">[</span><span class="n">buoy</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
            <span class="n">buoyds</span> <span class="o">=</span> <span class="n">buoyds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;Buoy&#39;</span><span class="p">:</span> <span class="n">buoy</span><span class="p">})</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="s1">&#39;Buoy&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># If an AOI can&#39;t be found in the dataset, ignore it</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">buoyds</span>

    <span class="k">def</span> <span class="nf">buoy_iwbdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buoy</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Retrieve IWB data subset for the specified buoy&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">station_id</span><span class="o">==</span><span class="n">buoy</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">match_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buoy</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">EooffshoreDataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Match IWB data to Zarr store data for the specified buoy&quot;&quot;&quot;</span>
        <span class="n">buoydf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buoy_iwbdata</span><span class="p">(</span><span class="n">buoy</span><span class="p">)</span>
        
        <span class="c1"># First, select the buoy dataset subset containing all available observations,</span>
        <span class="n">buoyds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buoy_dataset</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
        <span class="c1"># Drop any null values prior to matching</span>
        <span class="n">buoyds</span> <span class="o">=</span> <span class="n">buoyds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">buoyds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">## Remove any duplicated times</span>
        <span class="n">buoyds</span> <span class="o">=</span> <span class="n">buoyds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=~</span><span class="n">buoyds</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">duplicated</span><span class="p">())</span>

        <span class="c1"># Round time now if required</span>
        <span class="k">if</span> <span class="n">dataset</span><span class="o">.</span><span class="n">round_test_dataset_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dstime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">buoyds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">round_test_dataset_time</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dstime</span> <span class="o">=</span> <span class="n">buoyds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span> 
        
        <span class="n">buoydf</span> <span class="o">=</span> <span class="n">buoydf</span><span class="p">[</span><span class="n">buoydf</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">dstime</span><span class="p">)]</span>
                
        <span class="c1"># Select closest times to the available data</span>
        <span class="n">buoyds</span> <span class="o">=</span> <span class="n">buoyds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">buoydf</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        
        <span class="n">dsvariable</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{dataset.name}</span><span class="s1">_</span><span class="si">{variable}</span><span class="s1">&#39;</span>
        <span class="n">buoydf</span><span class="p">[</span><span class="n">dsvariable</span><span class="p">]</span> <span class="o">=</span> <span class="n">buoyds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Buoy</span><span class="o">=</span><span class="n">buoy</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">return</span> <span class="n">buoydf</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="load-the-ascat-reprocessed-store">
<h4>Load the ASCAT REProcessed store<a class="headerlink" href="#load-the-ascat-reprocessed-store" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Data is provided at 10m above surface level (<code class="docutils literal notranslate"><span class="pre">height</span></code> dimension).</p></li>
<li><p>The original <code class="docutils literal notranslate"><span class="pre">wind_to_dir</span></code> variable is rotated by 180 degrees to generate a (from) <code class="docutils literal notranslate"><span class="pre">wind_direction</span></code>, consistent with the other data sets.</p></li>
<li><p>It is possible to filter ASCAT data the provided quality flag masks (<code class="docutils literal notranslate"><span class="pre">wvc_quality_flag</span></code>). Consequently, two <code class="docutils literal notranslate"><span class="pre">EooffshoreDataset</span></code> instances are created, containing:</p>
<ul>
<li><p>All ASCAT observations</p></li>
<li><p>Observations filtered using <code class="docutils literal notranslate"><span class="pre">wvc_quality_flag</span></code></p></li>
</ul>
</li>
<li><p>The <a class="reference internal" href="ASCAT_ICS_Wind_Data.html"><span class="doc std std-doc">ASCAT Wind Data for Irish Continental Shelf region</span></a> notebook describes the store creation and quality flags.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ascatall</span> <span class="o">=</span> <span class="n">XarrayEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ASCAT-ALL&#39;</span><span class="p">,</span> 
                                   <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;eooffshore_ics_cms_WIND_GLO_WIND_L3_REP_OBSERVATIONS_012_005_MetOp_ASCAT&#39;</span><span class="p">,</span>
                                   <span class="n">rotate_longitude</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">rename_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="s1">&#39;longitude&#39;</span><span class="p">},</span>
                                   <span class="n">round_test_dataset_time</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span>
                                  <span class="p">)</span>

<span class="n">ascatwqf</span> <span class="o">=</span> <span class="n">XarrayEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ASCAT-WQF&#39;</span><span class="p">,</span> 
                                   <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;eooffshore_ics_cms_WIND_GLO_WIND_L3_REP_OBSERVATIONS_012_005_MetOp_ASCAT&#39;</span><span class="p">,</span>
                                   <span class="n">rotate_longitude</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">rename_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="s1">&#39;longitude&#39;</span><span class="p">},</span>
                                   <span class="n">round_test_dataset_time</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span>
                                  <span class="p">)</span>

<span class="c1"># Retain data based on corresponding wind vector cell quality flag</span>
<span class="n">ASCAT_NO_FLAG_SET</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ASCAT_SMALL_WIND_LESS_THAN_OR_EQUAL_TO_3_M_S</span> <span class="o">=</span> <span class="mi">2048</span>
<span class="n">ASCAT_SOME_PORTION_OF_WVC_IS_OVER_LAND</span> <span class="o">=</span> <span class="mi">32768</span>

<span class="n">acceptable_ascat_flag_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">ASCAT_NO_FLAG_SET</span><span class="p">,</span> 
                               <span class="n">ASCAT_NO_FLAG_SET</span><span class="p">,</span> <span class="c1"># Included twice for subsequent combination sums</span>
                               <span class="n">ASCAT_SMALL_WIND_LESS_THAN_OR_EQUAL_TO_3_M_S</span><span class="p">,</span> 
                               <span class="n">ASCAT_SOME_PORTION_OF_WVC_IS_OVER_LAND</span><span class="p">]</span>
<span class="c1"># Accept all flag mask combinations</span>
<span class="n">acceptable_ascat_flag_masks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">acceptable_ascat_flag_masks</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
<span class="n">ascatwqf</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">ascatwqf</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ascatwqf</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">wvc_quality_flag</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">acceptable_ascat_flag_masks</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="load-the-ccmp-store">
<h4>Load the CCMP store<a class="headerlink" href="#load-the-ccmp-store" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Data is provided at 10m above surface level (<code class="docutils literal notranslate"><span class="pre">height</span></code> dimension).</p></li>
<li><p>Retain data having at least one observation used to derive CCMP wind vector components.</p></li>
<li><p>The <a class="reference internal" href="CCMP_ICS_Wind_Data.html"><span class="doc std std-doc">CCMP Wind Data for Irish Continental Shelf region</span></a> notebook describes the store creation and <code class="docutils literal notranslate"><span class="pre">nobs</span></code> filtering.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ccmp</span> <span class="o">=</span> <span class="n">XarrayEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;CCMP&#39;</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;eooffshore_ics_ccmp_v02_1_nrt_wind&#39;</span><span class="p">,</span> <span class="n">rotate_longitude</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ccmp</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">ccmp</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ccmp</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">nobs</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="load-the-era5-store">
<h4>Load the ERA5 store<a class="headerlink" href="#load-the-era5-store" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Data is provided at both 10m and 100m above surface level (<code class="docutils literal notranslate"><span class="pre">height</span></code> dimension).</p></li>
<li><p>The <a class="reference internal" href="ERA5_ICS_Wind_Data.html"><span class="doc std std-doc">ERA5 Wind Data for Irish Continental Shelf region</span></a> notebook describes the store creation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">era5</span> <span class="o">=</span> <span class="n">XarrayEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ERA5&#39;</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;eooffshore_ics_era5_single_level_hourly_wind&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="load-the-mera-store">
<h4>Load the MÉRA store<a class="headerlink" href="#load-the-mera-store" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Data is provided at multiple heights above surface level (<code class="docutils literal notranslate"><span class="pre">height</span></code> dimension).</p></li>
<li><p>The <a class="reference internal" href="MERA_ICS_Wind_Data.html"><span class="doc std std-doc">MÉRA Wind Data for Irish Continental Shelf region</span></a> notebook describes the store creation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mera</span> <span class="o">=</span> <span class="n">CurvilinearEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MÉRA&#39;</span><span class="p">,</span> 
                                    <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> 
                                    <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;eooffshore_ics_mera_wind_ANALYSIS&#39;</span><span class="p">,</span> 
                                    <span class="n">rotate_longitude</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="load-the-newa-stores">
<h4>Load the NEWA stores<a class="headerlink" href="#load-the-newa-stores" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">NewaEOOffshoreDataset</span></code> instance contains a map of AOI -&gt; <code class="docutils literal notranslate"><span class="pre">CurvilinearEooffshoreDataset</span></code>, with each of the latter backed by a <a class="reference external" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.html"><code class="docutils literal notranslate"><span class="pre">xarray.Dataset</span></code></a></p></li>
<li><p>Data is provided at multiple heights above surface level (<code class="docutils literal notranslate"><span class="pre">height</span></code> dimension).</p></li>
<li><p>Wind power density is provided.</p></li>
<li><p>The <a class="reference internal" href="NEWA_ICS_Wind_Data.html"><span class="doc std std-doc">NEWA Wind Data for Irish Continental Shelf region</span></a> notebook describes creation of the AOI stores.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newa</span> <span class="o">=</span> <span class="n">NewaEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;NEWA&#39;</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;NEWA&#39;</span><span class="p">,</span> <span class="n">aoi_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;M2&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_irishsea&#39;</span><span class="p">,</span> 
                                                                                           <span class="s1">&#39;M3&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_m3&#39;</span><span class="p">,</span> 
                                                                                           <span class="s1">&#39;M4&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_m4&#39;</span><span class="p">,</span> 
                                                                                           <span class="s1">&#39;M5&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_celticsea&#39;</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;Irish Sea 1&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_irishsea&#39;</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;Irish Sea 2&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_irishsea&#39;</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;Irish Sea 3&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_irishsea&#39;</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;Celtic Sea 1&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_celticsea&#39;</span><span class="p">,</span>
                                                                                           <span class="s1">&#39;Celtic Sea 2&#39;</span><span class="p">:</span> <span class="s1">&#39;eooffshore_ics_newa_celticsea&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="load-the-sentinel-1-store">
<h4>Load the Sentinel-1 store<a class="headerlink" href="#load-the-sentinel-1-store" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Data is provided at 10m above surface level (<code class="docutils literal notranslate"><span class="pre">height</span></code> dimension).</p></li>
<li><p>Retain grid data with:</p>
<ul>
<li><p>Wind data quality in [0, 2], i.e. filter poor/bad quality data</p></li>
<li><p>200+ SAR observations</p></li>
<li><p>Wind speed <span class="math notranslate nohighlight">\(\ge 1\)</span></p></li>
</ul>
</li>
<li><p>The <a class="reference internal" href="Sentinel-1_ICS_Wind_Data.html"><span class="doc std std-doc">Sentinel-1 Wind Data for Irish Continental Shelf region</span></a> notebook describes the store creation and data filtering.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sentinel1</span> <span class="o">=</span> <span class="n">CurvilinearEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sentinel-1&#39;</span><span class="p">,</span> 
                                           <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> 
                                           <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;eooffshore_ics_level3_sentinel1_ocn&#39;</span><span class="p">,</span> 
                                           <span class="n">rename_variables</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;owiWindDirection&#39;</span><span class="p">:</span> <span class="s1">&#39;wind_direction&#39;</span><span class="p">,</span> <span class="s1">&#39;owiWindSpeed&#39;</span><span class="p">:</span> <span class="s1">&#39;wind_speed&#39;</span><span class="p">},</span>
                                           <span class="n">round_test_dataset_time</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span>
                                           <span class="p">)</span>

<span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">owiWindQuality</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">owiWindQuality</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;total_sar_observations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="c1"># Exclude cells with low numbers of observations, and very low 10m wind speed values, including 0s</span>
<span class="c1"># The latter have been identified in analysis of wind speed distributions, and appear to be redundant</span>
<span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">total_sar_observations</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sentinel1</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="load-aoi-catalog-data">
<h3>Load AOI catalog data<a class="headerlink" href="#load-aoi-catalog-data" title="Permalink to this headline">¶</a></h3>
<p>This section describes the AOI data sets contained in the EOOffshore catalog:</p>
<ol class="simple">
<li><p><a class="reference external" href="http://www.marine.ie/Home/site-area/data-services/real-time-observations/irish-weather-buoy-network-imos">Irish Weather Buoy Network</a> coordinates and data</p></li>
<li><p>Synthentic wind farm geometries</p></li>
</ol>
<section id="load-the-irish-weather-buoy-network-data">
<h4>Load the Irish Weather Buoy Network data<a class="headerlink" href="#load-the-irish-weather-buoy-network-data" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="http://www.marine.ie/Home/site-area/data-services/real-time-observations/irish-weather-buoy-network-imos">Irish Weather Buoy Network (IWB)</a>, managed by the <a class="reference external" href="https://www.marine.ie">Marine Institute</a> in collaboration with Met Éireann and the UK Met Office, is a network of five operational buoys providing regular sea surface observations including wind speed and direction. Hourly IWB data for 2001 to 2021 was retrieved from the <a class="reference external" href="https://erddap.marine.ie/erddap/index.html">Marine Institute ERDDAP server</a> and stored in a CSV file. The corresponding EOOffshore catalog entry is directly loaded into a <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html"><code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a>, retaining the wind speed, direction, and buoy coordinates data.</p>
<p>The satellite and reanalysis data sets contained in the EOOffshore catalog provide wind speed values at 10m above surface level. As the IWB buoy wind speed measurements are taken at 3m, it is necessary to extrapolate the latter to 10m values. As <a class="reference external" href="https://doi.org/10.3390/en12020206">Remmers et al., 2019</a> used the log law method to perform a similar operation, it is applied here. Further details are provided later in this notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">loglaw_extrapolate</span><span class="p">(</span><span class="n">z</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">zref</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">z0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0002</span><span class="p">):</span>
    <span class="c1"># Used for 3m -&gt;10m extrapolation by Remmers et al., 2019</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">z0</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">zref</span><span class="o">/</span><span class="n">z0</span><span class="p">))</span> <span class="o">*</span> <span class="n">wind_speed</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iwb</span> <span class="o">=</span> <span class="n">IwbEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;IWB&#39;</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;eooffshore_iwb_hourly&#39;</span><span class="p">)</span>

<span class="c1"># 3m extrapolated to 10m, similar to Remmers et al., 2019</span>
<span class="n">iwb</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s1">&#39;wind_speed10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loglaw_extrapolate</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">iwb</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">wind_speed3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="load-the-synthentic-wind-farm-shapefile">
<h4>Load the synthentic wind farm shapefile<a class="headerlink" href="#load-the-synthentic-wind-farm-shapefile" title="Permalink to this headline">¶</a></h4>
<p>A synthetic wind farm AOI data set was created for the EOOffshore project, illustrating potential wind farm locations in the Irish Sea and North Celtic Sea. The data set is a shapefile containing wind farm polygon geometries, which is loaded into a <a class="reference external" href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.html"><code class="docutils literal notranslate"><span class="pre">geopandas.GeoDataFrame</span></code></a>. These polygons, along with the IWB buoy coordinates, are used to select AOI data subsets of the Zarr store variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eoowindfarmds</span> <span class="o">=</span> <span class="n">WindfarmEooffshoreDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;EOOffshore WF&#39;</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;eooffshore_windfarms&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="comparison-of-in-situ-buoy-and-data-set-wind-speed">
<h2>Comparison of In situ Buoy and Data Set Wind Speed<a class="headerlink" href="#comparison-of-in-situ-buoy-and-data-set-wind-speed" title="Permalink to this headline">¶</a></h2>
<p>This section provides a comparison of in situ IWB buoy 10m wind speed values with corresponding wind speeds provided by the EOOffshore catalog data stores. All comparisons in this notebook generate:</p>
<ol class="simple">
<li><p>Metrics table containing entries for all stores</p></li>
<li><p>Density scatter plot for each IWB, data set pair</p></li>
</ol>
<hr class="docutils" />
<section id="comparison-metrics">
<h3>Comparison metrics<a class="headerlink" href="#comparison-metrics" title="Permalink to this headline">¶</a></h3>
<p>The following metrics are calculated for all comparisons in this notebook:</p>
<p><strong>Root Mean Square Error (RMSE)</strong></p>
<p><span class="math notranslate nohighlight">\(\mathrm{RMSE}(y, \hat{y}) = \sqrt{\frac{1}{n}\sum_{i=1}^{n}(y_i - \hat{y}_i)^2}\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y\)</span>: reference (true) variable, e.g. IWB buoy wind speed for a particular coordinate</p></li>
<li><p><span class="math notranslate nohighlight">\(\hat{y}\)</span>: test (predicted) variable, e.g. corresponding ERA5 wind speed for a particular coordinate</p></li>
<li><p><span class="math notranslate nohighlight">\(n\)</span>: number of samples/observations</p></li>
</ul>
<p>Uses <a class="reference external" href="https://scikit-learn.org/stable/modules/model_evaluation.html#mean-squared-error"><code class="docutils literal notranslate"><span class="pre">sklearn.metrics.mean_squared_error(squared=False)</span></code></a></p>
<p><strong>Mean Absolute Error (MAE)</strong></p>
<p><span class="math notranslate nohighlight">\(\mathrm{MAE}(y, \hat{y}) = \frac{1}{n} \sum_{i=1}^{n}|(y_i - \hat{y}_i)|\)</span></p>
<p>Uses <a class="reference external" href="https://scikit-learn.org/stable/modules/model_evaluation.html#mean-absolute-error"><code class="docutils literal notranslate"><span class="pre">sklearn.metrics.mean_absolute_error()</span></code></a></p>
<p><strong>Bias</strong></p>
<p><span class="math notranslate nohighlight">\(\mathrm{Bias}(y, \hat{y}) = \frac{1}{n} \sum_{i=1}^{n}(\hat{y}_i - y_i)\)</span></p>
<p><strong><span class="math notranslate nohighlight">\(\pmb{R^2}\)</span></strong></p>
<p><span class="math notranslate nohighlight">\(R^2(y, \hat{y}) = 1 - \dfrac{\sum_{i=1}^{n}|(y_i - \hat{y}_i)|}{\sum_{i=1}^{n}|(y_i - \bar{y})|}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\bar{y} = \frac{1}{n}\sum_{i=1}^{n}y_i\)</span></p>
<p>Uses <a class="reference external" href="https://scikit-learn.org/stable/modules/model_evaluation.html#r2-score-the-coefficient-of-determination"><code class="docutils literal notranslate"><span class="pre">sklearn.metrics.r2_score()</span></code></a></p>
<p><strong>Pearson Correlation Coefficient (<span class="math notranslate nohighlight">\(r\)</span>)</strong></p>
<p><span class="math notranslate nohighlight">\(r(y, \hat{y}) = \dfrac{\sum(y - \bar{y})(\hat{y} - \bar{\hat{y}})}{\sqrt{\sum(y - \bar{y})^2\sum(\hat{y} - \bar{\hat{y}})^2}}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\bar{\hat{y}} = \frac{1}{n}\sum_{i=1}^{n}\hat{y_i}\)</span></p>
<p>Uses <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.pearsonr.html"><code class="docutils literal notranslate"><span class="pre">scipy.stats.pearsonr()</span></code></a></p>
<p>The metrics calculations and density scatter plots are implemented in the following utility functions. Using Dask, the data set loading process is lazy, where no data is loaded inititally. Instead, data loading is <a class="reference external" href="https://tutorial.dask.org/01x_lazy.html">delayed until execution time, where variables will be loaded and processed in parallel according to the corresponding chunks specification</a>. Dask arrays implement a subset of the NumPy <a class="reference external" href="https://numpy.org/doc/stable/reference/arrays.ndarray.html"><code class="docutils literal notranslate"><span class="pre">ndarray</span></code></a> interface using blocked algorithms, and the original variable arrays will be split into smaller chunk arrays, enabling computation on arrays larger than memory using all available cores. The blocked algorithms are coordinated using <a class="reference external" href="https://docs.dask.org/en/stable/graphs.html">Dask graphs</a>.</p>
<p>Here, a subset of IWB and Zarr store data will be selected for each AOI, using matched coordinates and time, and a matched variable selected for comparison. Although Dask graph execution is typically triggered by calling <a class="reference external" href="https://docs.dask.org/en/stable/api.html#dask.compute"><code class="docutils literal notranslate"><span class="pre">compute()</span></code></a>, this will also automatically occur when a subset variable’s values are accessed (by means of metrics calculations and scatter plots). The resulting variable values will be contained in a NumPy <code class="docutils literal notranslate"><span class="pre">ndarray</span></code>.</p>
<p>Graph execution is managed by a <a class="reference external" href="https://docs.dask.org/en/stable/scheduling.html">task scheduler</a>. The default scheduler (used for executing this notebook) executes computations with <a class="reference external" href="https://docs.dask.org/en/stable/scheduling.html#local-threads">local threads</a>. However, execution may also be performed on a <a class="reference external" href="https://docs.dask.org/en/stable/scheduling.html#dask-distributed-local">distributed cluster</a> <strong>without any change to the <code class="docutils literal notranslate"><span class="pre">xarray</span></code> code used in this notebook</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Wind turbine speed cut-in/cut-out limits (m/s)</span>
<span class="n">CUT_IN_WIND_SPEED</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">CUT_OUT_WIND_SPEED</span> <span class="o">=</span> <span class="mi">25</span>

<span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate comparison metrics using true (reference) and predicted (test) values&quot;&quot;&quot;</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;$n$&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
               <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
               <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">),</span>
               <span class="s1">&#39;Bias&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">),</span>
               <span class="s1">&#39;$R^2$&#39;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">),</span>               
              <span class="p">}</span>
    <span class="c1"># In certain cases, e.g. Weibull-based power density estimation, only mean values will be specified</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">metrics</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;$r$&#39;</span><span class="p">:</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)[</span><span class="mi">0</span><span class="p">]})</span>
        
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">density_scatter_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a density scatter plot for comparing variable values from two data sets&quot;&quot;&quot;</span>
    <span class="c1"># Handle large number of points: https://stackoverflow.com/questions/20105364/how-can-i-make-a-scatter-plot-colored-by-density-in-matplotlib</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">x_e</span><span class="p">,</span> <span class="n">y_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">interpn</span><span class="p">((</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x_e</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">x_e</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">y_e</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">y_e</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span> <span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;splinef2d&quot;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Plot all data</span>
    <span class="n">z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">))]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Sort the points by density, so that the densest points are plotted last</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">buoy_metrics</span><span class="p">(</span><span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                 <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                 <span class="n">variable_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                 <span class="n">variable_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Compare IWB buoy variable values with those provided by the catalog Zarr stores&quot;&quot;&quot;</span>
    <span class="n">allmetrics</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">ascatwqf</span><span class="p">,</span> <span class="n">ccmp</span><span class="p">,</span> <span class="n">era5</span><span class="p">,</span> <span class="n">mera</span><span class="p">,</span> <span class="n">newa</span><span class="p">,</span> <span class="n">sentinel1</span><span class="p">]</span>
    
    <span class="n">variable_lim</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">variable_min</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">variable_max</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">dataset_cols</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">subplot_height</span> <span class="o">=</span> <span class="mf">5.5</span>
    <span class="n">subplot_wspace</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">figwidth</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">subplot_height</span> <span class="o">+</span> <span class="n">subplot_wspace</span><span class="p">)</span> <span class="o">*</span> <span class="n">dataset_cols</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">dataset_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figwidth</span><span class="p">,</span> <span class="n">subplot_height</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="n">subplot_wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">buoydf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Match data for all buoys</span>
        <span class="k">for</span> <span class="n">buoy</span> <span class="ow">in</span> <span class="n">iwb</span><span class="o">.</span><span class="n">buoy_coordinates</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">buoydf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">buoydf</span><span class="p">,</span> <span class="n">iwb</span><span class="o">.</span><span class="n">match_data</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">variable</span><span class="p">)),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unable to match IWB </span><span class="si">{buoy}</span><span class="s1"> data with </span><span class="si">{dataset.name}</span><span class="s1"> data&#39;</span><span class="p">)</span>

        <span class="n">dsvariable</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{dataset.name}</span><span class="s1">_</span><span class="si">{variable}</span><span class="s1">&#39;</span>
        <span class="n">iwbvariable</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{variable}{height}</span><span class="s1">&#39;</span>
        <span class="n">buoydf</span> <span class="o">=</span> <span class="n">buoydf</span><span class="p">[(</span><span class="n">buoydf</span><span class="p">[</span><span class="n">iwbvariable</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">variable_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">buoydf</span><span class="p">[</span><span class="n">iwbvariable</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">variable_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">buoydf</span><span class="p">[</span><span class="n">dsvariable</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">variable_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">buoydf</span><span class="p">[</span><span class="n">dsvariable</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">variable_max</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buoydf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No filtered </span><span class="si">{variable}</span><span class="s1"> available for match of IWB data with </span><span class="si">{dataset.name}</span><span class="s1"> data&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">continue</span>
          
        <span class="n">metricsdf</span> <span class="o">=</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">buoydf</span><span class="p">[</span><span class="n">iwbvariable</span><span class="p">],</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">buoydf</span><span class="p">[</span><span class="n">dsvariable</span><span class="p">])</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">dataset</span><span class="o">.</span><span class="n">name</span><span class="p">})</span><span class="o">.</span><span class="n">T</span>
        <span class="n">allmetrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metricsdf</span><span class="p">)</span>
        
        <span class="n">density_scatter_plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">buoydf</span><span class="p">[</span><span class="n">dsvariable</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">buoydf</span><span class="p">[</span><span class="n">iwbvariable</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dsvariable</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">iwbvariable</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">buoydf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{dataset.name}</span><span class="s1"> </span><span class="si">{height}</span><span class="s1">m wind speed ($n$ = {len(buoydf):,})&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">variable_lim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">variable_lim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{iwb.name}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{iwb.name}</span><span class="s1"> buoys - </span><span class="si">{height}</span><span class="s1">m wind speed&#39;</span><span class="p">)</span>
    
    <span class="n">allmetricsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">allmetrics</span><span class="p">)</span>
    <span class="n">dfstyle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;$n$&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">}</span>
    <span class="n">dfstyle</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">allmetricsdf</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]})</span>
    <span class="k">return</span> <span class="n">allmetricsdf</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfstyle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="wind-speed-summary">
<h3>Wind speed summary<a class="headerlink" href="#wind-speed-summary" title="Permalink to this headline">¶</a></h3>
<p>Mean 10m wind speed for IWB buoy coordinates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buoymeanws</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">buoy</span> <span class="ow">in</span> <span class="n">iwb</span><span class="o">.</span><span class="n">buoys</span><span class="p">:</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">ascatwqf</span><span class="p">,</span> <span class="n">ccmp</span><span class="p">,</span> <span class="n">era5</span><span class="p">,</span> <span class="n">mera</span><span class="p">,</span> <span class="n">newa</span><span class="o">.</span><span class="n">aoi_dataset</span><span class="p">(</span><span class="n">buoy</span><span class="p">),</span> <span class="n">sentinel1</span><span class="p">]</span>
    <span class="n">meanws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;IWB&#39;</span><span class="p">:</span> <span class="n">iwb</span><span class="o">.</span><span class="n">buoy_iwbdata</span><span class="p">(</span><span class="n">buoy</span><span class="p">)</span><span class="o">.</span><span class="n">wind_speed10</span><span class="o">.</span><span class="n">mean</span><span class="p">()}</span>
    <span class="n">meanws</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">dataset</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">iwb</span><span class="o">.</span><span class="n">buoy_dataset</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span> <span class="k">if</span> <span class="n">dataset</span><span class="p">})</span>
    <span class="n">buoymeanws</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meanws</span><span class="p">)</span>
<span class="n">iwbmeanwsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">buoymeanws</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">iwb</span><span class="o">.</span><span class="n">buoys</span><span class="p">)</span>
<span class="n">iwbmeanwsdf</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_a1c5d">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_a1c5d_level0_col0" class="col_heading level0 col0" >IWB</th>
      <th id="T_a1c5d_level0_col1" class="col_heading level0 col1" >ASCAT-ALL</th>
      <th id="T_a1c5d_level0_col2" class="col_heading level0 col2" >ASCAT-WQF</th>
      <th id="T_a1c5d_level0_col3" class="col_heading level0 col3" >CCMP</th>
      <th id="T_a1c5d_level0_col4" class="col_heading level0 col4" >ERA5</th>
      <th id="T_a1c5d_level0_col5" class="col_heading level0 col5" >MÉRA</th>
      <th id="T_a1c5d_level0_col6" class="col_heading level0 col6" >NEWA</th>
      <th id="T_a1c5d_level0_col7" class="col_heading level0 col7" >Sentinel-1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_a1c5d_level0_row0" class="row_heading level0 row0" >M2</th>
      <td id="T_a1c5d_row0_col0" class="data row0 col0" >8.14</td>
      <td id="T_a1c5d_row0_col1" class="data row0 col1" >7.96</td>
      <td id="T_a1c5d_row0_col2" class="data row0 col2" >7.98</td>
      <td id="T_a1c5d_row0_col3" class="data row0 col3" >8.29</td>
      <td id="T_a1c5d_row0_col4" class="data row0 col4" >7.80</td>
      <td id="T_a1c5d_row0_col5" class="data row0 col5" >8.00</td>
      <td id="T_a1c5d_row0_col6" class="data row0 col6" >8.24</td>
      <td id="T_a1c5d_row0_col7" class="data row0 col7" >8.15</td>
    </tr>
    <tr>
      <th id="T_a1c5d_level0_row1" class="row_heading level0 row1" >M3</th>
      <td id="T_a1c5d_row1_col0" class="data row1 col0" >8.75</td>
      <td id="T_a1c5d_row1_col1" class="data row1 col1" >8.73</td>
      <td id="T_a1c5d_row1_col2" class="data row1 col2" >8.73</td>
      <td id="T_a1c5d_row1_col3" class="data row1 col3" >8.75</td>
      <td id="T_a1c5d_row1_col4" class="data row1 col4" >8.51</td>
      <td id="T_a1c5d_row1_col5" class="data row1 col5" >8.82</td>
      <td id="T_a1c5d_row1_col6" class="data row1 col6" >9.02</td>
      <td id="T_a1c5d_row1_col7" class="data row1 col7" >8.44</td>
    </tr>
    <tr>
      <th id="T_a1c5d_level0_row2" class="row_heading level0 row2" >M4</th>
      <td id="T_a1c5d_row2_col0" class="data row2 col0" >9.20</td>
      <td id="T_a1c5d_row2_col1" class="data row2 col1" >9.09</td>
      <td id="T_a1c5d_row2_col2" class="data row2 col2" >9.08</td>
      <td id="T_a1c5d_row2_col3" class="data row2 col3" >9.20</td>
      <td id="T_a1c5d_row2_col4" class="data row2 col4" >8.86</td>
      <td id="T_a1c5d_row2_col5" class="data row2 col5" >9.26</td>
      <td id="T_a1c5d_row2_col6" class="data row2 col6" >9.51</td>
      <td id="T_a1c5d_row2_col7" class="data row2 col7" >9.06</td>
    </tr>
    <tr>
      <th id="T_a1c5d_level0_row3" class="row_heading level0 row3" >M5</th>
      <td id="T_a1c5d_row3_col0" class="data row3 col0" >8.46</td>
      <td id="T_a1c5d_row3_col1" class="data row3 col1" >8.19</td>
      <td id="T_a1c5d_row3_col2" class="data row3 col2" >8.19</td>
      <td id="T_a1c5d_row3_col3" class="data row3 col3" >8.16</td>
      <td id="T_a1c5d_row3_col4" class="data row3 col4" >8.03</td>
      <td id="T_a1c5d_row3_col5" class="data row3 col5" >8.42</td>
      <td id="T_a1c5d_row3_col6" class="data row3 col6" >8.49</td>
      <td id="T_a1c5d_row3_col7" class="data row3 col7" >8.18</td>
    </tr>
    <tr>
      <th id="T_a1c5d_level0_row4" class="row_heading level0 row4" >M6</th>
      <td id="T_a1c5d_row4_col0" class="data row4 col0" >9.37</td>
      <td id="T_a1c5d_row4_col1" class="data row4 col1" >9.72</td>
      <td id="T_a1c5d_row4_col2" class="data row4 col2" >9.72</td>
      <td id="T_a1c5d_row4_col3" class="data row4 col3" >9.68</td>
      <td id="T_a1c5d_row4_col4" class="data row4 col4" >9.38</td>
      <td id="T_a1c5d_row4_col5" class="data row4 col5" >9.53</td>
      <td id="T_a1c5d_row4_col6" class="data row4 col6" >nan</td>
      <td id="T_a1c5d_row4_col7" class="data row4 col7" >nan</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<hr class="docutils" />
<section id="iwb-wind-speed-comparison-with-data-sets">
<h3>IWB wind speed comparison with data sets<a class="headerlink" href="#iwb-wind-speed-comparison-with-data-sets" title="Permalink to this headline">¶</a></h3>
<p>IWB buoy 10m wind speed compared with all other data sets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buoy_metrics</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="s1">&#39;wind_speed&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">variable_min</span><span class="o">=</span><span class="n">CUT_IN_WIND_SPEED</span><span class="p">,</span> <span class="n">variable_max</span><span class="o">=</span><span class="n">CUT_OUT_WIND_SPEED</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unable to match IWB M6 data with NEWA data
Unable to match IWB M6 data with Sentinel-1 data
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
</style>
<table id="T_746c6">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_746c6_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_746c6_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_746c6_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_746c6_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_746c6_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_746c6_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_746c6_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_746c6_row0_col0" class="data row0 col0" >21,257</td>
      <td id="T_746c6_row0_col1" class="data row0 col1" >1.310</td>
      <td id="T_746c6_row0_col2" class="data row0 col2" >0.979</td>
      <td id="T_746c6_row0_col3" class="data row0 col3" >-0.072</td>
      <td id="T_746c6_row0_col4" class="data row0 col4" >0.863</td>
      <td id="T_746c6_row0_col5" class="data row0 col5" >0.932</td>
    </tr>
    <tr>
      <th id="T_746c6_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_746c6_row1_col0" class="data row1 col0" >21,005</td>
      <td id="T_746c6_row1_col1" class="data row1 col1" >1.300</td>
      <td id="T_746c6_row1_col2" class="data row1 col2" >0.973</td>
      <td id="T_746c6_row1_col3" class="data row1 col3" >-0.075</td>
      <td id="T_746c6_row1_col4" class="data row1 col4" >0.865</td>
      <td id="T_746c6_row1_col5" class="data row1 col5" >0.933</td>
    </tr>
    <tr>
      <th id="T_746c6_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_746c6_row2_col0" class="data row2 col0" >18,976</td>
      <td id="T_746c6_row2_col1" class="data row2 col1" >1.456</td>
      <td id="T_746c6_row2_col2" class="data row2 col2" >1.077</td>
      <td id="T_746c6_row2_col3" class="data row2 col3" >0.328</td>
      <td id="T_746c6_row2_col4" class="data row2 col4" >0.814</td>
      <td id="T_746c6_row2_col5" class="data row2 col5" >0.925</td>
    </tr>
    <tr>
      <th id="T_746c6_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_746c6_row3_col0" class="data row3 col0" >492,050</td>
      <td id="T_746c6_row3_col1" class="data row3 col1" >1.440</td>
      <td id="T_746c6_row3_col2" class="data row3 col2" >1.102</td>
      <td id="T_746c6_row3_col3" class="data row3 col3" >-0.374</td>
      <td id="T_746c6_row3_col4" class="data row3 col4" >0.835</td>
      <td id="T_746c6_row3_col5" class="data row3 col5" >0.921</td>
    </tr>
    <tr>
      <th id="T_746c6_level0_row4" class="row_heading level0 row4" >MÉRA</th>
      <td id="T_746c6_row4_col0" class="data row4 col0" >114,744</td>
      <td id="T_746c6_row4_col1" class="data row4 col1" >1.403</td>
      <td id="T_746c6_row4_col2" class="data row4 col2" >1.071</td>
      <td id="T_746c6_row4_col3" class="data row4 col3" >-0.238</td>
      <td id="T_746c6_row4_col4" class="data row4 col4" >0.843</td>
      <td id="T_746c6_row4_col5" class="data row4 col5" >0.925</td>
    </tr>
    <tr>
      <th id="T_746c6_level0_row5" class="row_heading level0 row5" >NEWA</th>
      <td id="T_746c6_row5_col0" class="data row5 col0" >195,899</td>
      <td id="T_746c6_row5_col1" class="data row5 col1" >1.948</td>
      <td id="T_746c6_row5_col2" class="data row5 col2" >1.447</td>
      <td id="T_746c6_row5_col3" class="data row5 col3" >0.335</td>
      <td id="T_746c6_row5_col4" class="data row5 col4" >0.669</td>
      <td id="T_746c6_row5_col5" class="data row5 col5" >0.859</td>
    </tr>
    <tr>
      <th id="T_746c6_level0_row6" class="row_heading level0 row6" >Sentinel-1</th>
      <td id="T_746c6_row6_col0" class="data row6 col0" >1,618</td>
      <td id="T_746c6_row6_col1" class="data row6 col1" >1.453</td>
      <td id="T_746c6_row6_col2" class="data row6 col2" >1.097</td>
      <td id="T_746c6_row6_col3" class="data row6 col3" >-0.540</td>
      <td id="T_746c6_row6_col4" class="data row6 col4" >0.827</td>
      <td id="T_746c6_row6_col5" class="data row6 col5" >0.928</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_32_2.png" src="_images/Comparison_Wind_Power_32_2.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="data-sets-wind-speed-comparison">
<h2>Data Sets Wind Speed Comparison<a class="headerlink" href="#data-sets-wind-speed-comparison" title="Permalink to this headline">¶</a></h2>
<p>In contrast to the previous section that compares IWB buoy data with corresponding satellite and reanalysis Zarr stores contained in the EOOffshore catalog, the remainder of this notebook focuses on comparisons between the Zarr stores. The approach is as follows:</p>
<ol class="simple">
<li><p>Select a <em>reference</em> data set (analagous to the role of IWB data in the previous section).</p></li>
<li><p>Select one or more <em>test</em> data sets.</p></li>
<li><p>Select AOI subsets of the <em>reference</em> and <em>test</em> data sets, using IWB buoy and wind farm coordinates, and the <code class="docutils literal notranslate"><span class="pre">time</span></code> dimension.</p></li>
<li><p>Calculate metrics for each <em>reference</em>-<em>test</em> data set comparison, and generate corresponding density scatter plots, for the specified variable/height parameters.</p></li>
</ol>
<p>Both the MÉRA and NEWA Zarr stores are used as <em>reference</em> data sets, as they provide data at multiple heights above the surface. They are not strictly considered as <em>ground truth</em> data sets, instead they are used here to demonstrate how the combination of the xarray, Dask, and Zarr libraries results in a scalable solution that can be applied to data sets of arbitrary sizes (related to heterogeneous spatial and temporal resolutions), as is the case with the EOOffshore catalog wind data sets. Parallel, out-of-core, computation of underlying variable chunks is achievable with identical calls to the xarray API. In the event of a future data set becoming available containing wind measurements at multiple heights (for example, LiDAR data) with high spatial coverage, it could be used as a more suitable <em>reference</em> data set.</p>
<p>Here are base classes that will be used for wind speed extrapolation. They are defined here as they are required for metrics calculation, and additional details will be provided later in this notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Extrapolator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base Extrapolator class&quot;&quot;&quot;</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">extrapolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">heights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Extrapolate data set variable to required heights&quot;&quot;&quot;</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">_add_extrapolated_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extrapolated</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">reindex_height</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">variable_attrs</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="p">{})</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span> 
        <span class="sd">&quot;&quot;&quot;Adds extrapolated values to existing variable, at height, and returns an updated Dataset&quot;&quot;&quot;</span>
        <span class="n">height_attrs</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">attrs</span>
        <span class="n">ea</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">vda</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">([</span><span class="s1">&#39;height&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">height</span><span class="p">,</span> <span class="n">vda</span> <span class="ow">in</span> <span class="n">extrapolated</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reindex_height</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">reindex</span><span class="p">({</span><span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">ea</span><span class="o">.</span><span class="n">height</span><span class="p">})</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ea</span>
        <span class="c1"># Height attributes are overwritten, restore them now</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">height_attrs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">variable_attrs</span><span class="p">:</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">variable_attrs</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">ds</span>
    
<span class="k">class</span> <span class="nc">WindSpeedExtrapolator</span><span class="p">(</span><span class="n">Extrapolator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base wind speed Extrapolator class&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">extrapolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">heights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">variable_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;wind_speed&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extrapolate wind speed to required heights&quot;&quot;&quot;</span>
        
        <span class="c1"># Retain pre-existing height if required</span>
        <span class="n">extrapolated_wind_speed</span> <span class="o">=</span> <span class="p">{</span><span class="n">height</span><span class="p">:</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span> <span class="k">for</span> <span class="n">height</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="n">height</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">heights</span><span class="p">}</span>

        <span class="c1"># Extrapolate to other heights</span>
        <span class="k">for</span> <span class="n">height</span> <span class="ow">in</span> <span class="p">[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">heights</span> <span class="k">if</span> <span class="n">h</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extrapolated_wind_speed</span><span class="p">]:</span>
            <span class="n">extrapolated_wind_speed</span><span class="p">[</span><span class="n">height</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extrapolate_wind_speed</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">extrapolation_height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">reference_height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="c1"># Reindex height dimension if required</span>
        <span class="n">reindex_height</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">heights</span> <span class="k">if</span> <span class="n">h</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">height</span><span class="o">.</span><span class="n">values</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_extrapolated_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">extrapolated_wind_speed</span><span class="p">,</span> <span class="n">reindex_height</span><span class="o">=</span><span class="n">reindex_height</span><span class="p">)</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_extrapolate_wind_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">extrapolation_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reference_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Wind speed extrapolation method implementation&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>These classes implement <em>reference</em> and <em>test</em> data set comparison, enabling AOI subset matching, metrics calculation, and density scatter plot generation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AoiDatasetComparison</span><span class="p">:</span>
    <span class="n">referenceds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span>
    <span class="n">testds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span>
    <span class="n">round_test_dataset_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AoiWindSpeedTestDataset</span><span class="p">:</span>
    <span class="n">eooffshore_dataset</span><span class="p">:</span> <span class="n">EooffshoreDataset</span>
    <span class="n">extrapolator</span><span class="p">:</span> <span class="n">WindSpeedExtrapolator</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AoiWindSpeedMetrics</span><span class="p">:</span>
    <span class="n">reference_dataset</span><span class="p">:</span> <span class="n">EooffshoreDataset</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">reference_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">test_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">comparison_height</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;wind_speed&#39;</span>
    <span class="n">variable_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">CUT_IN_WIND_SPEED</span>
    <span class="n">variable_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">CUT_OUT_WIND_SPEED</span>
    <span class="n">variable_lim</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">buoys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="s1">&#39;M3&#39;</span><span class="p">,</span> <span class="s1">&#39;M4&#39;</span><span class="p">,</span> <span class="s1">&#39;M5&#39;</span><span class="p">])</span>
    <span class="n">windfarms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">eoowindfarmds</span><span class="o">.</span><span class="n">windfarms</span><span class="p">)</span>
    <span class="n">discard_matches</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">matchesdf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">metricsdf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compare_datasets</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform extrapolation/estimation to required height&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_dataset</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_lim</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_min</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_max</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">test_dataset</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_datasets</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">extrapolator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="n">test_dataset</span><span class="o">.</span><span class="n">eooffshore_dataset</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">extrapolator</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">eooffshore_dataset</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> 
                                                                                            <span class="n">heights</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison_height</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">compare_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare reference data set with all test data sets, for all IWB and wind farm AOIs&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">test_eooffshore_dataset</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">eooffshore_dataset</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_datasets</span><span class="p">]:</span>
            <span class="n">dataset_comparisons</span> <span class="o">=</span> <span class="p">[</span><span class="n">AoiDatasetComparison</span><span class="p">(</span><span class="n">referenceds</span><span class="o">=</span><span class="n">iwb</span><span class="o">.</span><span class="n">buoy_dataset</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_dataset</span><span class="p">),</span> 
                                                        <span class="n">testds</span><span class="o">=</span><span class="n">iwb</span><span class="o">.</span><span class="n">buoy_dataset</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">test_eooffshore_dataset</span><span class="p">),</span>
                                                        <span class="n">round_test_dataset_time</span><span class="o">=</span><span class="n">test_eooffshore_dataset</span><span class="o">.</span><span class="n">round_test_dataset_time</span><span class="p">)</span> <span class="k">for</span> <span class="n">buoy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buoys</span><span class="p">]</span>
            <span class="n">dataset_comparisons</span> <span class="o">+=</span> <span class="p">[</span><span class="n">AoiDatasetComparison</span><span class="p">(</span><span class="n">referenceds</span><span class="o">=</span><span class="n">eoowindfarmds</span><span class="o">.</span><span class="n">windfarm_dataset</span><span class="p">(</span><span class="n">windfarm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference_dataset</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> 
                                                         <span class="n">testds</span><span class="o">=</span><span class="n">eoowindfarmds</span><span class="o">.</span><span class="n">windfarm_dataset</span><span class="p">(</span><span class="n">windfarm</span><span class="p">,</span> <span class="n">test_eooffshore_dataset</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                                                         <span class="n">round_test_dataset_time</span><span class="o">=</span><span class="n">test_eooffshore_dataset</span><span class="o">.</span><span class="n">round_test_dataset_time</span><span class="p">)</span> <span class="k">for</span> <span class="n">windfarm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">windfarms</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compare_test_dataset</span><span class="p">(</span><span class="n">dataset_comparisons</span><span class="p">,</span> <span class="n">test_eooffshore_dataset</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_comparison_plot</span><span class="p">()</span>

        <span class="n">dfstyle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;$n$&#39;</span><span class="p">:</span> <span class="s1">&#39;&amp;nbsp;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">}</span> 
        <span class="n">dfstyle</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;&amp;nbsp;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metricsdf</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metricsdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metricsdf</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfstyle</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metricsdf</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_matches</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">_match_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_comparison</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Match datasets on time and non-null variable values&quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">preprocess_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">deduplicate_time</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Time-related preprocessing&quot;&quot;&quot;</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison_height</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># Drop any null values prior to matching times</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">notnull</span><span class="p">(),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deduplicate_time</span><span class="p">:</span>
                <span class="c1"># Remove any duplicated times</span>
                <span class="n">variable</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=~</span><span class="n">variable</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">duplicated</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">variable</span>

        <span class="n">reference_variable</span> <span class="o">=</span> <span class="n">preprocess_variable</span><span class="p">(</span><span class="n">dataset_comparison</span><span class="o">.</span><span class="n">referenceds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">test_variable</span> <span class="o">=</span> <span class="n">preprocess_variable</span><span class="p">(</span><span class="n">dataset_comparison</span><span class="o">.</span><span class="n">testds</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">deduplicate_time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">test_variable</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
            <span class="c1"># Match time</span>
            <span class="k">if</span> <span class="n">dataset_comparison</span><span class="o">.</span><span class="n">round_test_dataset_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">test_variable_time</span> <span class="o">=</span> <span class="n">test_variable</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">test_variable_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">test_variable</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dataset_comparison</span><span class="o">.</span><span class="n">round_test_dataset_time</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                
            <span class="n">reference_variable</span> <span class="o">=</span> <span class="n">reference_variable</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">reference_variable</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">test_variable_time</span><span class="p">))</span>
            <span class="n">test_variable</span> <span class="o">=</span> <span class="n">test_variable</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">reference_variable</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">reference_variable</span><span class="p">,</span> <span class="n">test_variable</span>
        
    <span class="k">def</span> <span class="nf">_compare_test_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_comparisons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AoiDatasetComparison</span><span class="p">],</span> <span class="n">test_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compare reference-test data set pair for all AOIs&quot;&quot;&quot;</span>
        <span class="n">test_matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset_comparison</span> <span class="ow">in</span> <span class="n">dataset_comparisons</span><span class="p">:</span>
            <span class="n">reference_variable</span><span class="p">,</span> <span class="n">test_variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_variables</span><span class="p">(</span><span class="n">dataset_comparison</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
        
            <span class="c1"># Certain AOIs may not be found in the test dataset</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_variable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
                
            <span class="n">matchdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_name</span><span class="p">:</span> <span class="n">reference_variable</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,),</span> 
                                    <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="n">test_variable</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)})</span>
            <span class="n">matchdf</span> <span class="o">=</span> <span class="n">matchdf</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

            <span class="c1"># Filter as required</span>
            <span class="n">matchdf</span> <span class="o">=</span> <span class="n">matchdf</span><span class="p">[(</span><span class="n">matchdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">matchdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">matchdf</span><span class="o">.</span><span class="n">Test</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">matchdf</span><span class="o">.</span><span class="n">Test</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_max</span><span class="p">)]</span>
            <span class="n">test_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matchdf</span><span class="p">)</span>

        <span class="n">test_matchesdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">test_matches</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">test_matchesdf</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span><span class="p">,</span> <span class="n">test_matchesdf</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        
        <span class="n">test_metricsdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_metrics</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">test_matchesdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_name</span><span class="p">],</span> 
                                                 <span class="n">y_pred</span><span class="o">=</span><span class="n">test_matchesdf</span><span class="o">.</span><span class="n">Test</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">test_name</span><span class="p">})</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metricsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">metricsdf</span><span class="p">,</span> <span class="n">test_metricsdf</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate comparison metrics using true (reference) and predicted (test) values&quot;&quot;&quot;</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;$n$&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                   <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">),</span>
                   <span class="s1">&#39;Bias&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">),</span>
                   <span class="s1">&#39;$R^2$&#39;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">),</span>
                   <span class="s1">&#39;$r$&#39;</span><span class="p">:</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                  <span class="p">}</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_comparison_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a density scatter plot for all reference-test data set pairs&quot;&quot;&quot;</span>
        <span class="n">num_test_datasets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_datasets</span><span class="p">)</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">num_test_datasets</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">num_test_datasets</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">num_test_datasets</span> <span class="o">&gt;</span> <span class="n">ncols</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">subplot_height</span> <span class="o">=</span> <span class="mf">5.5</span>
        <span class="n">subplot_wspace</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">figwidth</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">subplot_height</span> <span class="o">+</span> <span class="n">subplot_wspace</span><span class="p">)</span> <span class="o">*</span> <span class="n">ncols</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figwidth</span><span class="p">,</span> <span class="n">subplot_height</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="n">subplot_wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">if</span> <span class="n">num_test_datasets</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>

        <span class="n">variable_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">test_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">test_matchesdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span><span class="o">.</span><span class="n">Dataset</span><span class="o">==</span><span class="n">test_name</span><span class="p">]</span>
            <span class="n">density_scatter_plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">test_matchesdf</span><span class="o">.</span><span class="n">Test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">test_matchesdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">test_matchesdf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{test_name}</span><span class="s1"> </span><span class="si">{self.comparison_height}</span><span class="s1">m </span><span class="si">{variable_label}</span><span class="s1"> ($n$ = {len(test_matchesdf):,})&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_lim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_lim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">test_name</span><span class="p">);</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_name</span><span class="p">);</span>
        <span class="c1"># Disable any axes if required</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">ncols</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">)</span> <span class="o">-</span> <span class="n">num_test_datasets</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{self.reference_name}</span><span class="s1"> </span><span class="si">{self.comparison_height}</span><span class="s1">m </span><span class="si">{variable_label}</span><span class="s1"> (IWB buoy, wind farm AOIs)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<section id="m-wind-speed">
<h3>10m wind speed<a class="headerlink" href="#m-wind-speed" title="Permalink to this headline">¶</a></h3>
<p>This section provides 10m wind speed comparison outputs</p>
<hr class="docutils" />
<section id="mera-10m-wind-speed">
<h4>MÉRA 10m wind speed<a class="headerlink" href="#mera-10m-wind-speed" title="Permalink to this headline">¶</a></h4>
<p>MÉRA 10m wind speed is compared with corresponding wind speed provided by other data sets at the IWB buoy and wind farm AOI coordinates.</p>
<ul class="simple">
<li><p>Sentinel-1 is excluded as data starts from mid-2017, while MÉRA provides data until the end of 2016.</p></li>
<li><p>The M6 IWB buoy is excluded as NEWA data is unavailable for these coordinates</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">mera</span><span class="p">,</span>
                    <span class="n">test_datasets</span><span class="o">=</span><span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">ascatwqf</span><span class="p">,</span> <span class="n">ccmp</span><span class="p">,</span> <span class="n">era5</span><span class="p">,</span> <span class="n">newa</span><span class="p">]],</span>
                    <span class="n">comparison_height</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_d8c00">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_d8c00_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_d8c00_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_d8c00_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_d8c00_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_d8c00_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_d8c00_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_d8c00_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_d8c00_row0_col0" class="data row0 col0" >&nbsp;5,363</td>
      <td id="T_d8c00_row0_col1" class="data row0 col1" >&nbsp;1.393</td>
      <td id="T_d8c00_row0_col2" class="data row0 col2" >&nbsp;1.059</td>
      <td id="T_d8c00_row0_col3" class="data row0 col3" >&nbsp;-0.151</td>
      <td id="T_d8c00_row0_col4" class="data row0 col4" >&nbsp;0.847</td>
      <td id="T_d8c00_row0_col5" class="data row0 col5" >&nbsp;0.921</td>
    </tr>
    <tr>
      <th id="T_d8c00_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_d8c00_row1_col0" class="data row1 col0" >&nbsp;4,495</td>
      <td id="T_d8c00_row1_col1" class="data row1 col1" >&nbsp;1.368</td>
      <td id="T_d8c00_row1_col2" class="data row1 col2" >&nbsp;1.049</td>
      <td id="T_d8c00_row1_col3" class="data row1 col3" >&nbsp;-0.200</td>
      <td id="T_d8c00_row1_col4" class="data row1 col4" >&nbsp;0.852</td>
      <td id="T_d8c00_row1_col5" class="data row1 col5" >&nbsp;0.925</td>
    </tr>
    <tr>
      <th id="T_d8c00_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_d8c00_row2_col0" class="data row2 col0" >&nbsp;11,225</td>
      <td id="T_d8c00_row2_col1" class="data row2 col1" >&nbsp;1.496</td>
      <td id="T_d8c00_row2_col2" class="data row2 col2" >&nbsp;1.141</td>
      <td id="T_d8c00_row2_col3" class="data row2 col3" >&nbsp;0.172</td>
      <td id="T_d8c00_row2_col4" class="data row2 col4" >&nbsp;0.816</td>
      <td id="T_d8c00_row2_col5" class="data row2 col5" >&nbsp;0.911</td>
    </tr>
    <tr>
      <th id="T_d8c00_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_d8c00_row3_col0" class="data row3 col0" >&nbsp;370,942</td>
      <td id="T_d8c00_row3_col1" class="data row3 col1" >&nbsp;1.442</td>
      <td id="T_d8c00_row3_col2" class="data row3 col2" >&nbsp;1.113</td>
      <td id="T_d8c00_row3_col3" class="data row3 col3" >&nbsp;-0.731</td>
      <td id="T_d8c00_row3_col4" class="data row3 col4" >&nbsp;0.832</td>
      <td id="T_d8c00_row3_col5" class="data row3 col5" >&nbsp;0.937</td>
    </tr>
    <tr>
      <th id="T_d8c00_level0_row4" class="row_heading level0 row4" >NEWA</th>
      <td id="T_d8c00_row4_col0" class="data row4 col0" >&nbsp;184,816</td>
      <td id="T_d8c00_row4_col1" class="data row4 col1" >&nbsp;1.792</td>
      <td id="T_d8c00_row4_col2" class="data row4 col2" >&nbsp;1.326</td>
      <td id="T_d8c00_row4_col3" class="data row4 col3" >&nbsp;0.142</td>
      <td id="T_d8c00_row4_col4" class="data row4 col4" >&nbsp;0.743</td>
      <td id="T_d8c00_row4_col5" class="data row4 col5" >&nbsp;0.875</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_40_1.png" src="_images/Comparison_Wind_Power_40_1.png" />
</div>
</div>
</section>
<hr class="docutils" />
<section id="newa-10m-wind-speed">
<h4>NEWA 10m wind speed<a class="headerlink" href="#newa-10m-wind-speed" title="Permalink to this headline">¶</a></h4>
<p>NEWA 10m wind speed is compared with corresponding wind speed provided by other data sets at the IWB buoy and wind farm AOI coordinates.</p>
<ul class="simple">
<li><p>Sentinel-1 is included as NEWA provides data until the end of 2016.</p></li>
<li><p>The M6 IWB buoy is excluded as NEWA data is unavailable for these coordinates</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">newa</span><span class="p">,</span>
                    <span class="n">test_datasets</span><span class="o">=</span><span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">ascatwqf</span><span class="p">,</span> <span class="n">ccmp</span><span class="p">,</span> <span class="n">era5</span><span class="p">,</span> <span class="n">mera</span><span class="p">,</span> <span class="n">sentinel1</span><span class="p">]],</span>
                    <span class="n">comparison_height</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_e4cd9">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_e4cd9_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_e4cd9_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_e4cd9_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_e4cd9_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_e4cd9_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_e4cd9_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e4cd9_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_e4cd9_row0_col0" class="data row0 col0" >&nbsp;24,829</td>
      <td id="T_e4cd9_row0_col1" class="data row0 col1" >&nbsp;1.733</td>
      <td id="T_e4cd9_row0_col2" class="data row0 col2" >&nbsp;1.288</td>
      <td id="T_e4cd9_row0_col3" class="data row0 col3" >&nbsp;-0.255</td>
      <td id="T_e4cd9_row0_col4" class="data row0 col4" >&nbsp;0.770</td>
      <td id="T_e4cd9_row0_col5" class="data row0 col5" >&nbsp;0.881</td>
    </tr>
    <tr>
      <th id="T_e4cd9_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_e4cd9_row1_col0" class="data row1 col0" >&nbsp;20,828</td>
      <td id="T_e4cd9_row1_col1" class="data row1 col1" >&nbsp;1.699</td>
      <td id="T_e4cd9_row1_col2" class="data row1 col2" >&nbsp;1.262</td>
      <td id="T_e4cd9_row1_col3" class="data row1 col3" >&nbsp;-0.289</td>
      <td id="T_e4cd9_row1_col4" class="data row1 col4" >&nbsp;0.782</td>
      <td id="T_e4cd9_row1_col5" class="data row1 col5" >&nbsp;0.888</td>
    </tr>
    <tr>
      <th id="T_e4cd9_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_e4cd9_row2_col0" class="data row2 col0" >&nbsp;20,665</td>
      <td id="T_e4cd9_row2_col1" class="data row2 col1" >&nbsp;1.627</td>
      <td id="T_e4cd9_row2_col2" class="data row2 col2" >&nbsp;1.216</td>
      <td id="T_e4cd9_row2_col3" class="data row2 col3" >&nbsp;0.052</td>
      <td id="T_e4cd9_row2_col4" class="data row2 col4" >&nbsp;0.786</td>
      <td id="T_e4cd9_row2_col5" class="data row2 col5" >&nbsp;0.895</td>
    </tr>
    <tr>
      <th id="T_e4cd9_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_e4cd9_row3_col0" class="data row3 col0" >&nbsp;689,818</td>
      <td id="T_e4cd9_row3_col1" class="data row3 col1" >&nbsp;1.936</td>
      <td id="T_e4cd9_row3_col2" class="data row3 col2" >&nbsp;1.465</td>
      <td id="T_e4cd9_row3_col3" class="data row3 col3" >&nbsp;-0.899</td>
      <td id="T_e4cd9_row3_col4" class="data row3 col4" >&nbsp;0.709</td>
      <td id="T_e4cd9_row3_col5" class="data row3 col5" >&nbsp;0.878</td>
    </tr>
    <tr>
      <th id="T_e4cd9_level0_row4" class="row_heading level0 row4" >MÉRA</th>
      <td id="T_e4cd9_row4_col0" class="data row4 col0" >&nbsp;184,816</td>
      <td id="T_e4cd9_row4_col1" class="data row4 col1" >&nbsp;1.792</td>
      <td id="T_e4cd9_row4_col2" class="data row4 col2" >&nbsp;1.326</td>
      <td id="T_e4cd9_row4_col3" class="data row4 col3" >&nbsp;-0.142</td>
      <td id="T_e4cd9_row4_col4" class="data row4 col4" >&nbsp;0.753</td>
      <td id="T_e4cd9_row4_col5" class="data row4 col5" >&nbsp;0.875</td>
    </tr>
    <tr>
      <th id="T_e4cd9_level0_row5" class="row_heading level0 row5" >Sentinel-1</th>
      <td id="T_e4cd9_row5_col0" class="data row5 col0" >&nbsp;2,325</td>
      <td id="T_e4cd9_row5_col1" class="data row5 col1" >&nbsp;2.317</td>
      <td id="T_e4cd9_row5_col2" class="data row5 col2" >&nbsp;1.822</td>
      <td id="T_e4cd9_row5_col3" class="data row5 col3" >&nbsp;-1.264</td>
      <td id="T_e4cd9_row5_col4" class="data row5 col4" >&nbsp;0.572</td>
      <td id="T_e4cd9_row5_col5" class="data row5 col5" >&nbsp;0.838</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_42_1.png" src="_images/Comparison_Wind_Power_42_1.png" />
</div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="wind-speed-extrapolation">
<h2>Wind Speed Extrapolation<a class="headerlink" href="#wind-speed-extrapolation" title="Permalink to this headline">¶</a></h2>
<p>Wind speed extrapolation is the process of extrapolating data values at provided heights to one or more required heights for which data is unavailable, generating a wind speed profile at an AOI. For satellite or reanalysis, data is usually restricted to values at 10m above the surface level. Consequently, extrapolation may be used with these 10m data to generate wind speed values at typical <a class="reference external" href="https://www.wind-energy-the-facts.org/hub-height.html">wind turbine hub heights</a>. The following publications provide examples of wind speed extrapolation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://doi.org/10.1175/JAMC-D-15-0197.1">Badger et al. (2016) - Extrapolating Satellite Winds to Turbine Operating Heights</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1016/j.apenergy.2016.01.135">Shu et al. (2016) - Observations of offshore wind characteristics by Doppler-LiDAR for wind energy applications</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1016/j.renene.2016.10.063">Carvalho et al. (2017) - Offshore winds and wind energy production estimates derived from ASCAT, OSCAT, numerical
weather prediction models and buoys – A comparative study for the Iberian Peninsula Atlantic coast</a></p></li>
<li><p><a class="reference external" href="https://iopscience.iop.org/article/10.1088/1742-6596/1037/5/052007">Karagali et al. (2018) - New European wind atlas offshore</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.3390/en12020206">Remmers et al. (2019) - The Potential of Advanced Scatterometer (ASCAT) 12.5 km Coastal Observations for Offshore Wind Farm Site Selection in Irish Waters</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5194/wes-5-1023-2020">de Montera et al. (2020) - Validation of Sentinel-1 offshore winds and average wind power estimation around Ireland</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5194/wes-5-1097-2020">Schelbergen et al. (2020) - Clustering wind profile shapes to estimate airborne wind energy production</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1016/j.rser.2020.110167">Xu et al. (2020) - Proliferation of offshore wind farms in the North Sea and surrounding waters revealed by satellite image time series</a></p></li>
</ul>
<p>This section is not intended to be a complete analysis of possible extrapolation methods. Instead, its objective is to demonstrate how a comparison of methods may be implemented using the scalable approach offered by the combination of the xarray, Dask and Zarr libraries, applied to data at multiple heights provided by MÉRA and NEWA.</p>
<hr class="docutils" />
<section id="power-law-extrapolation">
<h3>Power law extrapolation<a class="headerlink" href="#power-law-extrapolation" title="Permalink to this headline">¶</a></h3>
<p>The power law method is often used for extrapolating 10m wind speed observations to hub heights (for example, <a class="reference external" href="https://doi.org/10.3390/en12020206">Remmers et al., 2019</a>; <a class="reference external" href="https://doi.org/10.5194/wes-5-1097-2020">Schelbergen et al., 2020</a>). It is defined as follows (<a class="reference external" href="https://journals.ametsoc.org/view/journals/apme/33/6/1520-0450_1994_033_0757_dtplwp_2_0_co_2.xml">Hsu et al., 1994 - Determining the Power-Law Wind-Profile Exponent under Near-Neutral Stability Conditions at Sea</a>):</p>
<p><span class="math notranslate nohighlight">\(u = u_r\left(\dfrac{z}{z_r}\right)^\alpha\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(u\)</span>: wind speed (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>) at required height <span class="math notranslate nohighlight">\(z\)</span> (<span class="math notranslate nohighlight">\(m\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(z_r\)</span>: reference height (e.g. 10m for data provided by ERA5, Sentinel-1 etc.)</p></li>
<li><p><span class="math notranslate nohighlight">\(u_r\)</span>: wind speed at <span class="math notranslate nohighlight">\(z_r\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span>: function of atmospheric stability and surface characteristics</p></li>
</ul>
<p>This class provides an implementation of power law extrapolation that will operate on the EOOffshore Zarr stores</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PowerLawWindSpeedExtrapolator</span><span class="p">(</span><span class="n">WindSpeedExtrapolator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wind speed Extrapolator implementation, using the power law method&quot;&quot;&quot;</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.11</span> <span class="c1"># Hsu 1994</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.11</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
    
    <span class="k">def</span> <span class="nf">_extrapolate_wind_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extrapolation_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reference_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Wind speed extrapolation method implementation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">reference_height</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">extrapolation_height</span><span class="o">/</span><span class="n">reference_height</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
    
<span class="n">powerlaw_extrapolator</span> <span class="o">=</span> <span class="n">PowerLawWindSpeedExtrapolator</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<section id="mera-125m-wind-speed-comparison">
<h4>MÉRA 125m wind speed comparison<a class="headerlink" href="#mera-125m-wind-speed-comparison" title="Permalink to this headline">¶</a></h4>
<p>10m wind speed is extrapolated using the power law method, and compared with the corresponding MÉRA 125m wind speed at the IWB buoy and wind farm AOI coordinates.</p>
<p>This data structure is used to record wind speed extrapolation comparison metrics obtained throughout this notebook</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wind_speed_extrapolation_metrics</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatwqf</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ccmp</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">era5</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">)]</span>

<span class="n">wind_speed_extrapolation_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">mera</span><span class="p">,</span>
                                                            <span class="n">test_datasets</span><span class="o">=</span><span class="n">test_datasets</span><span class="p">,</span>
                                                            <span class="n">comparison_height</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Power Law&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_949d2">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_949d2_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_949d2_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_949d2_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_949d2_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_949d2_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_949d2_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_949d2_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_949d2_row0_col0" class="data row0 col0" >&nbsp;5,521</td>
      <td id="T_949d2_row0_col1" class="data row0 col1" >&nbsp;2.185</td>
      <td id="T_949d2_row0_col2" class="data row0 col2" >&nbsp;1.721</td>
      <td id="T_949d2_row0_col3" class="data row0 col3" >&nbsp;0.740</td>
      <td id="T_949d2_row0_col4" class="data row0 col4" >&nbsp;0.744</td>
      <td id="T_949d2_row0_col5" class="data row0 col5" >&nbsp;0.889</td>
    </tr>
    <tr>
      <th id="T_949d2_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_949d2_row1_col0" class="data row1 col0" >&nbsp;4,627</td>
      <td id="T_949d2_row1_col1" class="data row1 col1" >&nbsp;2.152</td>
      <td id="T_949d2_row1_col2" class="data row1 col2" >&nbsp;1.699</td>
      <td id="T_949d2_row1_col3" class="data row1 col3" >&nbsp;0.730</td>
      <td id="T_949d2_row1_col4" class="data row1 col4" >&nbsp;0.753</td>
      <td id="T_949d2_row1_col5" class="data row1 col5" >&nbsp;0.894</td>
    </tr>
    <tr>
      <th id="T_949d2_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_949d2_row2_col0" class="data row2 col0" >&nbsp;11,461</td>
      <td id="T_949d2_row2_col1" class="data row2 col1" >&nbsp;2.504</td>
      <td id="T_949d2_row2_col2" class="data row2 col2" >&nbsp;1.995</td>
      <td id="T_949d2_row2_col3" class="data row2 col3" >&nbsp;1.259</td>
      <td id="T_949d2_row2_col4" class="data row2 col4" >&nbsp;0.651</td>
      <td id="T_949d2_row2_col5" class="data row2 col5" >&nbsp;0.881</td>
    </tr>
    <tr>
      <th id="T_949d2_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_949d2_row3_col0" class="data row3 col0" >&nbsp;385,710</td>
      <td id="T_949d2_row3_col1" class="data row3 col1" >&nbsp;1.668</td>
      <td id="T_949d2_row3_col2" class="data row3 col2" >&nbsp;1.299</td>
      <td id="T_949d2_row3_col3" class="data row3 col3" >&nbsp;0.058</td>
      <td id="T_949d2_row3_col4" class="data row3 col4" >&nbsp;0.853</td>
      <td id="T_949d2_row3_col5" class="data row3 col5" >&nbsp;0.924</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_48_1.png" src="_images/Comparison_Wind_Power_48_1.png" />
</div>
</div>
</section>
<hr class="docutils" />
<section id="newa-150m-wind-speed-comparison">
<h4>NEWA 150m wind speed comparison<a class="headerlink" href="#newa-150m-wind-speed-comparison" title="Permalink to this headline">¶</a></h4>
<p>150m wind speed is extrapolated using the power law method, and compared with the corresponding NEWA 150m wind speed at the IWB buoy and wind farm AOI coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatwqf</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ccmp</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">era5</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">sentinel1</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">)</span>
                <span class="p">]</span>

<span class="n">wind_speed_extrapolation_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">newa</span><span class="p">,</span>
                                                            <span class="n">test_datasets</span><span class="o">=</span><span class="n">test_datasets</span><span class="p">,</span>
                                                            <span class="n">comparison_height</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Power Law&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_e7917">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_e7917_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_e7917_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_e7917_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_e7917_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_e7917_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_e7917_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e7917_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_e7917_row0_col0" class="data row0 col0" >&nbsp;25,408</td>
      <td id="T_e7917_row0_col1" class="data row0 col1" >&nbsp;2.814</td>
      <td id="T_e7917_row0_col2" class="data row0 col2" >&nbsp;2.215</td>
      <td id="T_e7917_row0_col3" class="data row0 col3" >&nbsp;1.013</td>
      <td id="T_e7917_row0_col4" class="data row0 col4" >&nbsp;0.610</td>
      <td id="T_e7917_row0_col5" class="data row0 col5" >&nbsp;0.828</td>
    </tr>
    <tr>
      <th id="T_e7917_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_e7917_row1_col0" class="data row1 col0" >&nbsp;21,274</td>
      <td id="T_e7917_row1_col1" class="data row1 col1" >&nbsp;2.785</td>
      <td id="T_e7917_row1_col2" class="data row1 col2" >&nbsp;2.198</td>
      <td id="T_e7917_row1_col3" class="data row1 col3" >&nbsp;1.027</td>
      <td id="T_e7917_row1_col4" class="data row1 col4" >&nbsp;0.622</td>
      <td id="T_e7917_row1_col5" class="data row1 col5" >&nbsp;0.835</td>
    </tr>
    <tr>
      <th id="T_e7917_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_e7917_row2_col0" class="data row2 col0" >&nbsp;21,078</td>
      <td id="T_e7917_row2_col1" class="data row2 col1" >&nbsp;2.964</td>
      <td id="T_e7917_row2_col2" class="data row2 col2" >&nbsp;2.342</td>
      <td id="T_e7917_row2_col3" class="data row2 col3" >&nbsp;1.480</td>
      <td id="T_e7917_row2_col4" class="data row2 col4" >&nbsp;0.526</td>
      <td id="T_e7917_row2_col5" class="data row2 col5" >&nbsp;0.837</td>
    </tr>
    <tr>
      <th id="T_e7917_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_e7917_row3_col0" class="data row3 col0" >&nbsp;716,184</td>
      <td id="T_e7917_row3_col1" class="data row3 col1" >&nbsp;2.277</td>
      <td id="T_e7917_row3_col2" class="data row3 col2" >&nbsp;1.748</td>
      <td id="T_e7917_row3_col3" class="data row3 col3" >&nbsp;0.144</td>
      <td id="T_e7917_row3_col4" class="data row3 col4" >&nbsp;0.741</td>
      <td id="T_e7917_row3_col5" class="data row3 col5" >&nbsp;0.866</td>
    </tr>
    <tr>
      <th id="T_e7917_level0_row4" class="row_heading level0 row4" >Sentinel-1</th>
      <td id="T_e7917_row4_col0" class="data row4 col0" >&nbsp;2,424</td>
      <td id="T_e7917_row4_col1" class="data row4 col1" >&nbsp;2.813</td>
      <td id="T_e7917_row4_col2" class="data row4 col2" >&nbsp;2.167</td>
      <td id="T_e7917_row4_col3" class="data row4 col3" >&nbsp;-0.306</td>
      <td id="T_e7917_row4_col4" class="data row4 col4" >&nbsp;0.580</td>
      <td id="T_e7917_row4_col5" class="data row4 col5" >&nbsp;0.791</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_50_1.png" src="_images/Comparison_Wind_Power_50_1.png" />
</div>
</div>
</section>
<hr class="docutils" />
<section id="power-law-alpha-estimation">
<h4>Power law <span class="math notranslate nohighlight">\(\alpha\)</span> estimation<a class="headerlink" href="#power-law-alpha-estimation" title="Permalink to this headline">¶</a></h4>
<p>A value of <span class="math notranslate nohighlight">\(\alpha\)</span> = 0.1 or 0.11 is often used as a good approximation for use at sea with the power law method (<a class="reference external" href="https://journals.ametsoc.org/view/journals/apme/33/6/1520-0450_1994_033_0757_dtplwp_2_0_co_2.xml">Hsu et al., 1994</a>). However, the positive Bias obtained with the corresponding comparisons (in contrast to the 10m comparisons Bias) may identify that the extrapolated wind speeds are overestimated, suggesting that an alternative <span class="math notranslate nohighlight">\(\alpha\)</span> value may be more suitable. For example, the ERA5 data set provides wind speed at both 10m and 100m, which may be used to calculate <span class="math notranslate nohighlight">\(\alpha\)</span> as follows:</p>
<p><span class="math notranslate nohighlight">\(\alpha = \dfrac{\mathrm{ln}\left(\dfrac{u_2}{u_1}\right)}{\mathrm{ln}\left(\dfrac{z_2}{z_1}\right)}\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(z_1\)</span>: height 1, e.g. 10m</p></li>
<li><p><span class="math notranslate nohighlight">\(z_2\)</span>: height 2, e.g. 100m</p></li>
<li><p><span class="math notranslate nohighlight">\(u_1\)</span>: wind speed (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>) at height <span class="math notranslate nohighlight">\(z_1\)</span>, e.g. ERA5 10m wind speed</p></li>
<li><p><span class="math notranslate nohighlight">\(u_2\)</span>: wind speed (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>) at height <span class="math notranslate nohighlight">\(z_2\)</span>, e.g. ERA5 100m wind speed</p></li>
</ul>
<p>Here, the following are computed:</p>
<ol class="simple">
<li><p>An ERA5 <code class="docutils literal notranslate"><span class="pre">powerlaw_alpha</span></code> variable, computed at each time for all grid coordinates. This will be used for extrapolating ERA5 10m wind speed to heights other than 100m.</p></li>
<li><p>A power law extrapolator using <code class="docutils literal notranslate"><span class="pre">powerlaw_alpha</span></code>.</p></li>
</ol>
<p><strong>Note:</strong></p>
<ul class="simple">
<li><p><strong>xarray provides implementations of certain <a class="reference external" href="https://numpy.org/doc/stable/reference/ufuncs.html">NumPy universal functions (ufunc)</a>, including <a class="reference external" href="https://xarray.pydata.org/en/stable/generated/xarray.ufuncs.log.html"><code class="docutils literal notranslate"><span class="pre">xarray.ufuncs.log()</span></code></a> as used to calculate <span class="math notranslate nohighlight">\(\alpha\)</span>. Using ufuncs ensures that lazy computation applies, i.e. the corresponding Dask graph execution does not occur until <code class="docutils literal notranslate"><span class="pre">compute()</span></code> is called.</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">default_powerlaw_era5</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">era5</span><span class="p">)</span>
<span class="n">default_powerlaw_era5</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ERA5 (alpha=0.11)&#39;</span>

<span class="n">alpha_powerlaw_era5</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">era5</span><span class="p">)</span>
<span class="n">alpha_powerlaw_era5</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ERA5 (alpha=ERA5)&#39;</span>

<span class="n">era5</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;powerlaw_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">era5</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="n">era5</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">100</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>

<span class="n">era5_alpha_powerlaw_extrapolator</span> <span class="o">=</span> <span class="n">PowerLawWindSpeedExtrapolator</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">era5</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">powerlaw_alpha</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>ERA5 10m wind speed is extrapolated using the Power Law method with <code class="docutils literal notranslate"><span class="pre">power_alpha</span></code>, and compared with the corresponding ERA5 15m wind speed at the IWB buoy and wind farm AOI coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_datasets</span><span class="o">=</span><span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">default_powerlaw_era5</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">),</span>
               <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">alpha_powerlaw_era5</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">era5_alpha_powerlaw_extrapolator</span><span class="p">)</span>
              <span class="p">]</span>
<span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">era5</span><span class="p">,</span>
                    <span class="n">test_datasets</span><span class="o">=</span><span class="n">test_datasets</span><span class="p">,</span>
                    <span class="n">comparison_height</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_1083f">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_1083f_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_1083f_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_1083f_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_1083f_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_1083f_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_1083f_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_1083f_level0_row0" class="row_heading level0 row0" >ERA5 (alpha=0.11)</th>
      <td id="T_1083f_row0_col0" class="data row0 col0" >&nbsp;1,520,056</td>
      <td id="T_1083f_row0_col1" class="data row0 col1" >&nbsp;0.823</td>
      <td id="T_1083f_row0_col2" class="data row0 col2" >&nbsp;0.689</td>
      <td id="T_1083f_row0_col3" class="data row0 col3" >&nbsp;0.325</td>
      <td id="T_1083f_row0_col4" class="data row0 col4" >&nbsp;0.961</td>
      <td id="T_1083f_row0_col5" class="data row0 col5" >&nbsp;0.984</td>
    </tr>
    <tr>
      <th id="T_1083f_level0_row1" class="row_heading level0 row1" >ERA5 (alpha=ERA5)</th>
      <td id="T_1083f_row1_col0" class="data row1 col0" >&nbsp;1,527,165</td>
      <td id="T_1083f_row1_col1" class="data row1 col1" >&nbsp;0.000</td>
      <td id="T_1083f_row1_col2" class="data row1 col2" >&nbsp;0.000</td>
      <td id="T_1083f_row1_col3" class="data row1 col3" >&nbsp;-0.000</td>
      <td id="T_1083f_row1_col4" class="data row1 col4" >&nbsp;1.000</td>
      <td id="T_1083f_row1_col5" class="data row1 col5" >&nbsp;1.000</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_54_1.png" src="_images/Comparison_Wind_Power_54_1.png" />
</div>
</div>
<p>An exact match with no errors is obtained. Here is the ERA5 <code class="docutils literal notranslate"><span class="pre">power_alpha</span></code> distribution</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_alphadf</span> <span class="o">=</span> <span class="n">era5</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">powerlaw_alpha</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
<span class="n">mean_alphadf</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Comparison_Wind_Power_56_0.png" src="_images/Comparison_Wind_Power_56_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_alphadf</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>powerlaw_alpha</th>
      <td>4165.0</td>
      <td>0.080109</td>
      <td>0.034877</td>
      <td>0.06259</td>
      <td>0.06878</td>
      <td>0.070319</td>
      <td>0.072935</td>
      <td>0.249005</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Power Law extrapolation comparisons are now made as follows:</p>
<ol class="simple">
<li><p>ERA5 10m wind speed will be extrapolated using the <code class="docutils literal notranslate"><span class="pre">powerlaw_alpha</span></code> variable, computed at each time for all grid coordinates.</p></li>
<li><p>A power law extrapolator with <span class="math notranslate nohighlight">\(\alpha\)</span> = mean ERA5 <code class="docutils literal notranslate"><span class="pre">powerlaw_alpha</span></code> will be used for the other data sets.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span> <span class="o">=</span> <span class="n">PowerLawWindSpeedExtrapolator</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">mean_alphadf</span><span class="o">.</span><span class="n">powerlaw_alpha</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="mera-125m-wind-speed-comparison-using-era5-power-law-alpha">
<h4>MÉRA 125m wind speed comparison using ERA5 power law <span class="math notranslate nohighlight">\(\alpha\)</span><a class="headerlink" href="#mera-125m-wind-speed-comparison-using-era5-power-law-alpha" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatwqf</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ccmp</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">era5</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">era5_alpha_powerlaw_extrapolator</span><span class="p">)]</span>

<span class="n">wind_speed_extrapolation_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">mera</span><span class="p">,</span>
                                                            <span class="n">test_datasets</span><span class="o">=</span><span class="n">test_datasets</span><span class="p">,</span>
                                                            <span class="n">comparison_height</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Power Law (ERA5-based alpha)&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_75b79">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_75b79_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_75b79_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_75b79_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_75b79_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_75b79_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_75b79_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_75b79_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_75b79_row0_col0" class="data row0 col0" >&nbsp;5,509</td>
      <td id="T_75b79_row0_col1" class="data row0 col1" >&nbsp;1.990</td>
      <td id="T_75b79_row0_col2" class="data row0 col2" >&nbsp;1.542</td>
      <td id="T_75b79_row0_col3" class="data row0 col3" >&nbsp;-0.071</td>
      <td id="T_75b79_row0_col4" class="data row0 col4" >&nbsp;0.789</td>
      <td id="T_75b79_row0_col5" class="data row0 col5" >&nbsp;0.890</td>
    </tr>
    <tr>
      <th id="T_75b79_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_75b79_row1_col0" class="data row1 col0" >&nbsp;4,614</td>
      <td id="T_75b79_row1_col1" class="data row1 col1" >&nbsp;1.957</td>
      <td id="T_75b79_row1_col2" class="data row1 col2" >&nbsp;1.520</td>
      <td id="T_75b79_row1_col3" class="data row1 col3" >&nbsp;-0.086</td>
      <td id="T_75b79_row1_col4" class="data row1 col4" >&nbsp;0.797</td>
      <td id="T_75b79_row1_col5" class="data row1 col5" >&nbsp;0.895</td>
    </tr>
    <tr>
      <th id="T_75b79_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_75b79_row2_col0" class="data row2 col0" >&nbsp;11,482</td>
      <td id="T_75b79_row2_col1" class="data row2 col1" >&nbsp;2.117</td>
      <td id="T_75b79_row2_col2" class="data row2 col2" >&nbsp;1.655</td>
      <td id="T_75b79_row2_col3" class="data row2 col3" >&nbsp;0.438</td>
      <td id="T_75b79_row2_col4" class="data row2 col4" >&nbsp;0.758</td>
      <td id="T_75b79_row2_col5" class="data row2 col5" >&nbsp;0.884</td>
    </tr>
    <tr>
      <th id="T_75b79_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_75b79_row3_col0" class="data row3 col0" >&nbsp;383,488</td>
      <td id="T_75b79_row3_col1" class="data row3 col1" >&nbsp;1.427</td>
      <td id="T_75b79_row3_col2" class="data row3 col2" >&nbsp;1.075</td>
      <td id="T_75b79_row3_col3" class="data row3 col3" >&nbsp;-0.309</td>
      <td id="T_75b79_row3_col4" class="data row3 col4" >&nbsp;0.891</td>
      <td id="T_75b79_row3_col5" class="data row3 col5" >&nbsp;0.947</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_61_1.png" src="_images/Comparison_Wind_Power_61_1.png" />
</div>
</div>
</section>
<hr class="docutils" />
<section id="newa-150m-wind-speed-comparison-using-era5-power-law-alpha">
<h4>NEWA 150m wind speed comparison using ERA5 power law <span class="math notranslate nohighlight">\(\alpha\)</span><a class="headerlink" href="#newa-150m-wind-speed-comparison-using-era5-power-law-alpha" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatwqf</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ccmp</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">era5</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">era5_alpha_powerlaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">sentinel1</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">),</span>
                <span class="p">]</span>

<span class="n">wind_speed_extrapolation_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">newa</span><span class="p">,</span>
                                                            <span class="n">test_datasets</span><span class="o">=</span><span class="n">test_datasets</span><span class="p">,</span>
                                                            <span class="n">comparison_height</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Power Law (ERA5-based alpha)&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_5ec36">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_5ec36_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_5ec36_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_5ec36_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_5ec36_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_5ec36_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_5ec36_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_5ec36_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_5ec36_row0_col0" class="data row0 col0" >&nbsp;25,363</td>
      <td id="T_5ec36_row0_col1" class="data row0 col1" >&nbsp;2.559</td>
      <td id="T_5ec36_row0_col2" class="data row0 col2" >&nbsp;1.993</td>
      <td id="T_5ec36_row0_col3" class="data row0 col3" >&nbsp;0.126</td>
      <td id="T_5ec36_row0_col4" class="data row0 col4" >&nbsp;0.680</td>
      <td id="T_5ec36_row0_col5" class="data row0 col5" >&nbsp;0.829</td>
    </tr>
    <tr>
      <th id="T_5ec36_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_5ec36_row1_col0" class="data row1 col0" >&nbsp;21,232</td>
      <td id="T_5ec36_row1_col1" class="data row1 col1" >&nbsp;2.523</td>
      <td id="T_5ec36_row1_col2" class="data row1 col2" >&nbsp;1.966</td>
      <td id="T_5ec36_row1_col3" class="data row1 col3" >&nbsp;0.133</td>
      <td id="T_5ec36_row1_col4" class="data row1 col4" >&nbsp;0.692</td>
      <td id="T_5ec36_row1_col5" class="data row1 col5" >&nbsp;0.836</td>
    </tr>
    <tr>
      <th id="T_5ec36_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_5ec36_row2_col0" class="data row2 col0" >&nbsp;21,109</td>
      <td id="T_5ec36_row2_col1" class="data row2 col1" >&nbsp;2.531</td>
      <td id="T_5ec36_row2_col2" class="data row2 col2" >&nbsp;1.975</td>
      <td id="T_5ec36_row2_col3" class="data row2 col3" >&nbsp;0.597</td>
      <td id="T_5ec36_row2_col4" class="data row2 col4" >&nbsp;0.664</td>
      <td id="T_5ec36_row2_col5" class="data row2 col5" >&nbsp;0.841</td>
    </tr>
    <tr>
      <th id="T_5ec36_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_5ec36_row3_col0" class="data row3 col0" >&nbsp;711,857</td>
      <td id="T_5ec36_row3_col1" class="data row3 col1" >&nbsp;1.983</td>
      <td id="T_5ec36_row3_col2" class="data row3 col2" >&nbsp;1.453</td>
      <td id="T_5ec36_row3_col3" class="data row3 col3" >&nbsp;-0.255</td>
      <td id="T_5ec36_row3_col4" class="data row3 col4" >&nbsp;0.803</td>
      <td id="T_5ec36_row3_col5" class="data row3 col5" >&nbsp;0.899</td>
    </tr>
    <tr>
      <th id="T_5ec36_level0_row4" class="row_heading level0 row4" >Sentinel-1</th>
      <td id="T_5ec36_row4_col0" class="data row4 col0" >&nbsp;2,410</td>
      <td id="T_5ec36_row4_col1" class="data row4 col1" >&nbsp;2.930</td>
      <td id="T_5ec36_row4_col2" class="data row4 col2" >&nbsp;2.282</td>
      <td id="T_5ec36_row4_col3" class="data row4 col3" >&nbsp;-1.105</td>
      <td id="T_5ec36_row4_col4" class="data row4 col4" >&nbsp;0.544</td>
      <td id="T_5ec36_row4_col5" class="data row4 col5" >&nbsp;0.791</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_63_1.png" src="_images/Comparison_Wind_Power_63_1.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="log-law-extrapolation">
<h3>Log law extrapolation<a class="headerlink" href="#log-law-extrapolation" title="Permalink to this headline">¶</a></h3>
<p>The log law method is an alternative extrapolation method. Here, it is implemented as defined by <a class="reference external" href="https://doi.org/10.3390/en12020206">Remmers et al., 2019</a>:</p>
<p><span class="math notranslate nohighlight">\(u = \dfrac{\mathrm{ln}\left(\dfrac{z}{z_0}\right)}{\mathrm{ln}\left(\dfrac{z_r}{z_0}\right)} \times u_r\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(u\)</span>: wind speed (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>) at required height <span class="math notranslate nohighlight">\(z\)</span> (<span class="math notranslate nohighlight">\(m\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(z_r\)</span>: reference height (3m in the case of IWB data, 10m in the case of ERA5 data etc.)</p></li>
<li><p><span class="math notranslate nohighlight">\(u_r\)</span>: wind speed at <span class="math notranslate nohighlight">\(z_r\)</span> (provided wind speed)</p></li>
<li><p><span class="math notranslate nohighlight">\(z_0\)</span>: surface roughness</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LogLawWindSpeedExtrapolator</span><span class="p">(</span><span class="n">WindSpeedExtrapolator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Wind speed Extrapolator implementation, using the log law method as defined in Remmers et al., 2019&quot;&quot;&quot;</span>
    <span class="n">z0</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0002</span> <span class="c1"># surface roughness length</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z0</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z0</span> <span class="o">=</span> <span class="n">z0</span>
    
    <span class="k">def</span> <span class="nf">_extrapolate_wind_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extrapolation_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reference_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Wind speed extrapolation method implementation&quot;&quot;&quot;</span>
        <span class="c1"># Use the implementation defined earlier in this notebook</span>
        <span class="k">return</span> <span class="n">loglaw_extrapolate</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">extrapolation_height</span><span class="p">,</span> <span class="n">wind_speed</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">reference_height</span><span class="p">),</span> <span class="n">zref</span><span class="o">=</span><span class="n">reference_height</span><span class="p">,</span> <span class="n">z0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z0</span><span class="p">)</span>

<span class="n">loglaw_extrapolator</span> <span class="o">=</span> <span class="n">LogLawWindSpeedExtrapolator</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<section id="id1">
<h4>MÉRA 125m wind speed comparison<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>10m wind speed is extrapolated using the log law method, and compared with the corresponding MÉRA 125m wind speed at the IWB buoy and wind farm AOI coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatwqf</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ccmp</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">era5</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">)]</span>

<span class="n">wind_speed_extrapolation_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">mera</span><span class="p">,</span>
                                                            <span class="n">test_datasets</span><span class="o">=</span><span class="n">test_datasets</span><span class="p">,</span>
                                                            <span class="n">comparison_height</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Log Law&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_7b25a">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_7b25a_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_7b25a_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_7b25a_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_7b25a_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_7b25a_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_7b25a_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_7b25a_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_7b25a_row0_col0" class="data row0 col0" >&nbsp;5,512</td>
      <td id="T_7b25a_row0_col1" class="data row0 col1" >&nbsp;1.993</td>
      <td id="T_7b25a_row0_col2" class="data row0 col2" >&nbsp;1.546</td>
      <td id="T_7b25a_row0_col3" class="data row0 col3" >&nbsp;0.006</td>
      <td id="T_7b25a_row0_col4" class="data row0 col4" >&nbsp;0.788</td>
      <td id="T_7b25a_row0_col5" class="data row0 col5" >&nbsp;0.890</td>
    </tr>
    <tr>
      <th id="T_7b25a_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_7b25a_row1_col0" class="data row1 col0" >&nbsp;4,615</td>
      <td id="T_7b25a_row1_col1" class="data row1 col1" >&nbsp;1.959</td>
      <td id="T_7b25a_row1_col2" class="data row1 col2" >&nbsp;1.524</td>
      <td id="T_7b25a_row1_col3" class="data row1 col3" >&nbsp;-0.007</td>
      <td id="T_7b25a_row1_col4" class="data row1 col4" >&nbsp;0.796</td>
      <td id="T_7b25a_row1_col5" class="data row1 col5" >&nbsp;0.895</td>
    </tr>
    <tr>
      <th id="T_7b25a_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_7b25a_row2_col0" class="data row2 col0" >&nbsp;11,477</td>
      <td id="T_7b25a_row2_col1" class="data row2 col1" >&nbsp;2.142</td>
      <td id="T_7b25a_row2_col2" class="data row2 col2" >&nbsp;1.678</td>
      <td id="T_7b25a_row2_col3" class="data row2 col3" >&nbsp;0.518</td>
      <td id="T_7b25a_row2_col4" class="data row2 col4" >&nbsp;0.751</td>
      <td id="T_7b25a_row2_col5" class="data row2 col5" >&nbsp;0.884</td>
    </tr>
    <tr>
      <th id="T_7b25a_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_7b25a_row3_col0" class="data row3 col0" >&nbsp;384,064</td>
      <td id="T_7b25a_row3_col1" class="data row3 col1" >&nbsp;1.772</td>
      <td id="T_7b25a_row3_col2" class="data row3 col2" >&nbsp;1.363</td>
      <td id="T_7b25a_row3_col3" class="data row3 col3" >&nbsp;-0.621</td>
      <td id="T_7b25a_row3_col4" class="data row3 col4" >&nbsp;0.834</td>
      <td id="T_7b25a_row3_col5" class="data row3 col5" >&nbsp;0.924</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_67_1.png" src="_images/Comparison_Wind_Power_67_1.png" />
</div>
</div>
</section>
<hr class="docutils" />
<section id="id2">
<h4>NEWA 150m wind speed comparison<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>10m wind speed is extrapolated using the log law method, and compared with the corresponding NEWA 150m wind speed at the IWB buoy and wind farm AOI coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatall</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatwqf</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ccmp</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">era5</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">),</span>
                 <span class="n">AoiWindSpeedTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">sentinel1</span><span class="p">,</span> <span class="n">extrapolator</span><span class="o">=</span><span class="n">loglaw_extrapolator</span><span class="p">),</span>
                <span class="p">]</span>

<span class="n">wind_speed_extrapolation_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AoiWindSpeedMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">newa</span><span class="p">,</span>
                                                            <span class="n">test_datasets</span><span class="o">=</span><span class="n">test_datasets</span><span class="p">,</span>
                                                            <span class="n">comparison_height</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Log Law&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_22436">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_22436_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_22436_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_22436_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_22436_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_22436_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_22436_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_22436_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_22436_row0_col0" class="data row0 col0" >&nbsp;25,368</td>
      <td id="T_22436_row0_col1" class="data row0 col1" >&nbsp;2.565</td>
      <td id="T_22436_row0_col2" class="data row0 col2" >&nbsp;2.000</td>
      <td id="T_22436_row0_col3" class="data row0 col3" >&nbsp;0.194</td>
      <td id="T_22436_row0_col4" class="data row0 col4" >&nbsp;0.679</td>
      <td id="T_22436_row0_col5" class="data row0 col5" >&nbsp;0.829</td>
    </tr>
    <tr>
      <th id="T_22436_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_22436_row1_col0" class="data row1 col0" >&nbsp;21,238</td>
      <td id="T_22436_row1_col1" class="data row1 col1" >&nbsp;2.529</td>
      <td id="T_22436_row1_col2" class="data row1 col2" >&nbsp;1.973</td>
      <td id="T_22436_row1_col3" class="data row1 col3" >&nbsp;0.202</td>
      <td id="T_22436_row1_col4" class="data row1 col4" >&nbsp;0.691</td>
      <td id="T_22436_row1_col5" class="data row1 col5" >&nbsp;0.836</td>
    </tr>
    <tr>
      <th id="T_22436_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_22436_row2_col0" class="data row2 col0" >&nbsp;21,104</td>
      <td id="T_22436_row2_col1" class="data row2 col1" >&nbsp;2.554</td>
      <td id="T_22436_row2_col2" class="data row2 col2" >&nbsp;1.995</td>
      <td id="T_22436_row2_col3" class="data row2 col3" >&nbsp;0.665</td>
      <td id="T_22436_row2_col4" class="data row2 col4" >&nbsp;0.658</td>
      <td id="T_22436_row2_col5" class="data row2 col5" >&nbsp;0.841</td>
    </tr>
    <tr>
      <th id="T_22436_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_22436_row3_col0" class="data row3 col0" >&nbsp;712,940</td>
      <td id="T_22436_row3_col1" class="data row3 col1" >&nbsp;2.324</td>
      <td id="T_22436_row3_col2" class="data row3 col2" >&nbsp;1.782</td>
      <td id="T_22436_row3_col3" class="data row3 col3" >&nbsp;-0.607</td>
      <td id="T_22436_row3_col4" class="data row3 col4" >&nbsp;0.731</td>
      <td id="T_22436_row3_col5" class="data row3 col5" >&nbsp;0.866</td>
    </tr>
    <tr>
      <th id="T_22436_level0_row4" class="row_heading level0 row4" >Sentinel-1</th>
      <td id="T_22436_row4_col0" class="data row4 col0" >&nbsp;2,410</td>
      <td id="T_22436_row4_col1" class="data row4 col1" >&nbsp;2.912</td>
      <td id="T_22436_row4_col2" class="data row4 col2" >&nbsp;2.265</td>
      <td id="T_22436_row4_col3" class="data row4 col3" >&nbsp;-1.043</td>
      <td id="T_22436_row4_col4" class="data row4 col4" >&nbsp;0.550</td>
      <td id="T_22436_row4_col5" class="data row4 col5" >&nbsp;0.791</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_69_1.png" src="_images/Comparison_Wind_Power_69_1.png" />
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="extrapolation-metrics-review">
<h3>Extrapolation metrics review<a class="headerlink" href="#extrapolation-metrics-review" title="Permalink to this headline">¶</a></h3>
<p>The following tables contain the extrapolation metrics obtained from the MÉRA and NEWA comparisons, where the “best” scores are highlighted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dataset_metrics_table</span><span class="p">(</span><span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AoiWindSpeedMetrics</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Display comparison metrics, highlighting best scores&quot;&quot;&quot;</span>
    <span class="n">dataset_metrics</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">method_metrics</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
        <span class="n">metricsdf</span> <span class="o">=</span> <span class="n">method_metrics</span><span class="o">.</span><span class="n">metricsdf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">mdf</span> <span class="o">=</span> <span class="n">metricsdf</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;Dataset&#39;</span><span class="p">})</span>
        <span class="n">mdf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;Method&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">method_metrics</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
        <span class="n">dataset_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mdf</span><span class="p">)</span>
    
    <span class="n">dataset_metricsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataset_metrics</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="s1">&#39;Method&#39;</span><span class="p">])</span>
    <span class="n">dfstyle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;$n$&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="p">}</span>
    <span class="n">dfstyle</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dataset_metricsdf</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]})</span>
    
    <span class="n">highlight_props</span> <span class="o">=</span> <span class="s1">&#39;color:white;background-color:darkblue&#39;</span>

    <span class="k">def</span> <span class="nf">highlight_max</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="n">highlight_props</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">props</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">highlight_min</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="n">highlight_props</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">props</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
    <span class="n">styleddf</span> <span class="o">=</span> <span class="n">dataset_metricsdf</span><span class="o">.</span><span class="n">style</span>

    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">dataset_metricsdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">min_slice_</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">dataset</span><span class="p">,:],</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span><span class="s1">&#39;Bias&#39;</span><span class="p">]]</span>
        <span class="n">max_slice_</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">dataset</span><span class="p">,:],</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;$R^2$&#39;</span><span class="p">:</span><span class="s1">&#39;$r$&#39;</span><span class="p">]]</span>
        <span class="n">styleddf</span> <span class="o">=</span> <span class="n">styleddf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">highlight_min</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">min_slice_</span><span class="p">)</span>\
                           <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">highlight_max</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">max_slice_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">styleddf</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dfstyle</span><span class="p">)</span>


<span class="n">reference_wind_speed_metrics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">wind_speed_extrapolation_metrics</span><span class="p">:</span>
    <span class="n">reference_wind_speed_metrics</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">reference_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="k">for</span> <span class="n">reference_dataset_label</span><span class="p">,</span> <span class="n">method_metrics</span> <span class="ow">in</span> <span class="n">reference_wind_speed_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Wind Speed Extrapolation Methods: compared with </span><span class="si">{reference_dataset_label}</span><span class="s1">**&#39;</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">dataset_metrics_table</span><span class="p">(</span><span class="n">method_metrics</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<hr class="docutils" />
<p><strong>Wind Speed Extrapolation Methods: compared with MÉRA</strong></p>
<div class="output text_html"><style type="text/css">
#T_f21b2_row1_col1, #T_f21b2_row1_col2, #T_f21b2_row1_col4, #T_f21b2_row2_col3, #T_f21b2_row2_col5, #T_f21b2_row4_col1, #T_f21b2_row4_col2, #T_f21b2_row4_col4, #T_f21b2_row5_col3, #T_f21b2_row5_col5, #T_f21b2_row7_col1, #T_f21b2_row7_col2, #T_f21b2_row7_col3, #T_f21b2_row7_col4, #T_f21b2_row7_col5, #T_f21b2_row9_col3, #T_f21b2_row10_col1, #T_f21b2_row10_col2, #T_f21b2_row10_col4, #T_f21b2_row10_col5 {
  color: white;
  background-color: darkblue;
}
</style>
<table id="T_f21b2">
  <thead>
    <tr>
      <th class="blank" >&nbsp;</th>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_f21b2_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_f21b2_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_f21b2_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_f21b2_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_f21b2_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_f21b2_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
    <tr>
      <th class="index_name level0" >Dataset</th>
      <th class="index_name level1" >Method</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_f21b2_level0_row0" class="row_heading level0 row0" rowspan="3">ASCAT-ALL</th>
      <th id="T_f21b2_level1_row0" class="row_heading level1 row0" >Power Law</th>
      <td id="T_f21b2_row0_col0" class="data row0 col0" >5,521</td>
      <td id="T_f21b2_row0_col1" class="data row0 col1" >2.185</td>
      <td id="T_f21b2_row0_col2" class="data row0 col2" >1.721</td>
      <td id="T_f21b2_row0_col3" class="data row0 col3" >0.740</td>
      <td id="T_f21b2_row0_col4" class="data row0 col4" >0.744</td>
      <td id="T_f21b2_row0_col5" class="data row0 col5" >0.889</td>
    </tr>
    <tr>
      <th id="T_f21b2_level1_row1" class="row_heading level1 row1" >Power Law (ERA5-based alpha)</th>
      <td id="T_f21b2_row1_col0" class="data row1 col0" >5,509</td>
      <td id="T_f21b2_row1_col1" class="data row1 col1" >1.990</td>
      <td id="T_f21b2_row1_col2" class="data row1 col2" >1.542</td>
      <td id="T_f21b2_row1_col3" class="data row1 col3" >-0.071</td>
      <td id="T_f21b2_row1_col4" class="data row1 col4" >0.789</td>
      <td id="T_f21b2_row1_col5" class="data row1 col5" >0.890</td>
    </tr>
    <tr>
      <th id="T_f21b2_level1_row2" class="row_heading level1 row2" >Log Law</th>
      <td id="T_f21b2_row2_col0" class="data row2 col0" >5,512</td>
      <td id="T_f21b2_row2_col1" class="data row2 col1" >1.993</td>
      <td id="T_f21b2_row2_col2" class="data row2 col2" >1.546</td>
      <td id="T_f21b2_row2_col3" class="data row2 col3" >0.006</td>
      <td id="T_f21b2_row2_col4" class="data row2 col4" >0.788</td>
      <td id="T_f21b2_row2_col5" class="data row2 col5" >0.890</td>
    </tr>
    <tr>
      <th id="T_f21b2_level0_row3" class="row_heading level0 row3" rowspan="3">ASCAT-WQF</th>
      <th id="T_f21b2_level1_row3" class="row_heading level1 row3" >Power Law</th>
      <td id="T_f21b2_row3_col0" class="data row3 col0" >4,627</td>
      <td id="T_f21b2_row3_col1" class="data row3 col1" >2.152</td>
      <td id="T_f21b2_row3_col2" class="data row3 col2" >1.699</td>
      <td id="T_f21b2_row3_col3" class="data row3 col3" >0.730</td>
      <td id="T_f21b2_row3_col4" class="data row3 col4" >0.753</td>
      <td id="T_f21b2_row3_col5" class="data row3 col5" >0.894</td>
    </tr>
    <tr>
      <th id="T_f21b2_level1_row4" class="row_heading level1 row4" >Power Law (ERA5-based alpha)</th>
      <td id="T_f21b2_row4_col0" class="data row4 col0" >4,614</td>
      <td id="T_f21b2_row4_col1" class="data row4 col1" >1.957</td>
      <td id="T_f21b2_row4_col2" class="data row4 col2" >1.520</td>
      <td id="T_f21b2_row4_col3" class="data row4 col3" >-0.086</td>
      <td id="T_f21b2_row4_col4" class="data row4 col4" >0.797</td>
      <td id="T_f21b2_row4_col5" class="data row4 col5" >0.895</td>
    </tr>
    <tr>
      <th id="T_f21b2_level1_row5" class="row_heading level1 row5" >Log Law</th>
      <td id="T_f21b2_row5_col0" class="data row5 col0" >4,615</td>
      <td id="T_f21b2_row5_col1" class="data row5 col1" >1.959</td>
      <td id="T_f21b2_row5_col2" class="data row5 col2" >1.524</td>
      <td id="T_f21b2_row5_col3" class="data row5 col3" >-0.007</td>
      <td id="T_f21b2_row5_col4" class="data row5 col4" >0.796</td>
      <td id="T_f21b2_row5_col5" class="data row5 col5" >0.895</td>
    </tr>
    <tr>
      <th id="T_f21b2_level0_row6" class="row_heading level0 row6" rowspan="3">CCMP</th>
      <th id="T_f21b2_level1_row6" class="row_heading level1 row6" >Power Law</th>
      <td id="T_f21b2_row6_col0" class="data row6 col0" >11,461</td>
      <td id="T_f21b2_row6_col1" class="data row6 col1" >2.504</td>
      <td id="T_f21b2_row6_col2" class="data row6 col2" >1.995</td>
      <td id="T_f21b2_row6_col3" class="data row6 col3" >1.259</td>
      <td id="T_f21b2_row6_col4" class="data row6 col4" >0.651</td>
      <td id="T_f21b2_row6_col5" class="data row6 col5" >0.881</td>
    </tr>
    <tr>
      <th id="T_f21b2_level1_row7" class="row_heading level1 row7" >Power Law (ERA5-based alpha)</th>
      <td id="T_f21b2_row7_col0" class="data row7 col0" >11,482</td>
      <td id="T_f21b2_row7_col1" class="data row7 col1" >2.117</td>
      <td id="T_f21b2_row7_col2" class="data row7 col2" >1.655</td>
      <td id="T_f21b2_row7_col3" class="data row7 col3" >0.438</td>
      <td id="T_f21b2_row7_col4" class="data row7 col4" >0.758</td>
      <td id="T_f21b2_row7_col5" class="data row7 col5" >0.884</td>
    </tr>
    <tr>
      <th id="T_f21b2_level1_row8" class="row_heading level1 row8" >Log Law</th>
      <td id="T_f21b2_row8_col0" class="data row8 col0" >11,477</td>
      <td id="T_f21b2_row8_col1" class="data row8 col1" >2.142</td>
      <td id="T_f21b2_row8_col2" class="data row8 col2" >1.678</td>
      <td id="T_f21b2_row8_col3" class="data row8 col3" >0.518</td>
      <td id="T_f21b2_row8_col4" class="data row8 col4" >0.751</td>
      <td id="T_f21b2_row8_col5" class="data row8 col5" >0.884</td>
    </tr>
    <tr>
      <th id="T_f21b2_level0_row9" class="row_heading level0 row9" rowspan="3">ERA5</th>
      <th id="T_f21b2_level1_row9" class="row_heading level1 row9" >Power Law</th>
      <td id="T_f21b2_row9_col0" class="data row9 col0" >385,710</td>
      <td id="T_f21b2_row9_col1" class="data row9 col1" >1.668</td>
      <td id="T_f21b2_row9_col2" class="data row9 col2" >1.299</td>
      <td id="T_f21b2_row9_col3" class="data row9 col3" >0.058</td>
      <td id="T_f21b2_row9_col4" class="data row9 col4" >0.853</td>
      <td id="T_f21b2_row9_col5" class="data row9 col5" >0.924</td>
    </tr>
    <tr>
      <th id="T_f21b2_level1_row10" class="row_heading level1 row10" >Power Law (ERA5-based alpha)</th>
      <td id="T_f21b2_row10_col0" class="data row10 col0" >383,488</td>
      <td id="T_f21b2_row10_col1" class="data row10 col1" >1.427</td>
      <td id="T_f21b2_row10_col2" class="data row10 col2" >1.075</td>
      <td id="T_f21b2_row10_col3" class="data row10 col3" >-0.309</td>
      <td id="T_f21b2_row10_col4" class="data row10 col4" >0.891</td>
      <td id="T_f21b2_row10_col5" class="data row10 col5" >0.947</td>
    </tr>
    <tr>
      <th id="T_f21b2_level1_row11" class="row_heading level1 row11" >Log Law</th>
      <td id="T_f21b2_row11_col0" class="data row11 col0" >384,064</td>
      <td id="T_f21b2_row11_col1" class="data row11 col1" >1.772</td>
      <td id="T_f21b2_row11_col2" class="data row11 col2" >1.363</td>
      <td id="T_f21b2_row11_col3" class="data row11 col3" >-0.621</td>
      <td id="T_f21b2_row11_col4" class="data row11 col4" >0.834</td>
      <td id="T_f21b2_row11_col5" class="data row11 col5" >0.924</td>
    </tr>
  </tbody>
</table>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>Wind Speed Extrapolation Methods: compared with NEWA</strong></p>
<div class="output text_html"><style type="text/css">
#T_7f041_row1_col1, #T_7f041_row1_col2, #T_7f041_row1_col3, #T_7f041_row1_col4, #T_7f041_row2_col5, #T_7f041_row4_col1, #T_7f041_row4_col2, #T_7f041_row4_col3, #T_7f041_row4_col4, #T_7f041_row5_col5, #T_7f041_row7_col1, #T_7f041_row7_col2, #T_7f041_row7_col3, #T_7f041_row7_col4, #T_7f041_row7_col5, #T_7f041_row9_col3, #T_7f041_row10_col1, #T_7f041_row10_col2, #T_7f041_row10_col4, #T_7f041_row10_col5, #T_7f041_row12_col1, #T_7f041_row12_col2, #T_7f041_row12_col3, #T_7f041_row12_col4, #T_7f041_row12_col5 {
  color: white;
  background-color: darkblue;
}
</style>
<table id="T_7f041">
  <thead>
    <tr>
      <th class="blank" >&nbsp;</th>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_7f041_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_7f041_level0_col1" class="col_heading level0 col1" >RMSE</th>
      <th id="T_7f041_level0_col2" class="col_heading level0 col2" >MAE</th>
      <th id="T_7f041_level0_col3" class="col_heading level0 col3" >Bias</th>
      <th id="T_7f041_level0_col4" class="col_heading level0 col4" >$R^2$</th>
      <th id="T_7f041_level0_col5" class="col_heading level0 col5" >$r$</th>
    </tr>
    <tr>
      <th class="index_name level0" >Dataset</th>
      <th class="index_name level1" >Method</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_7f041_level0_row0" class="row_heading level0 row0" rowspan="3">ASCAT-ALL</th>
      <th id="T_7f041_level1_row0" class="row_heading level1 row0" >Power Law</th>
      <td id="T_7f041_row0_col0" class="data row0 col0" >25,408</td>
      <td id="T_7f041_row0_col1" class="data row0 col1" >2.814</td>
      <td id="T_7f041_row0_col2" class="data row0 col2" >2.215</td>
      <td id="T_7f041_row0_col3" class="data row0 col3" >1.013</td>
      <td id="T_7f041_row0_col4" class="data row0 col4" >0.610</td>
      <td id="T_7f041_row0_col5" class="data row0 col5" >0.828</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row1" class="row_heading level1 row1" >Power Law (ERA5-based alpha)</th>
      <td id="T_7f041_row1_col0" class="data row1 col0" >25,363</td>
      <td id="T_7f041_row1_col1" class="data row1 col1" >2.559</td>
      <td id="T_7f041_row1_col2" class="data row1 col2" >1.993</td>
      <td id="T_7f041_row1_col3" class="data row1 col3" >0.126</td>
      <td id="T_7f041_row1_col4" class="data row1 col4" >0.680</td>
      <td id="T_7f041_row1_col5" class="data row1 col5" >0.829</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row2" class="row_heading level1 row2" >Log Law</th>
      <td id="T_7f041_row2_col0" class="data row2 col0" >25,368</td>
      <td id="T_7f041_row2_col1" class="data row2 col1" >2.565</td>
      <td id="T_7f041_row2_col2" class="data row2 col2" >2.000</td>
      <td id="T_7f041_row2_col3" class="data row2 col3" >0.194</td>
      <td id="T_7f041_row2_col4" class="data row2 col4" >0.679</td>
      <td id="T_7f041_row2_col5" class="data row2 col5" >0.829</td>
    </tr>
    <tr>
      <th id="T_7f041_level0_row3" class="row_heading level0 row3" rowspan="3">ASCAT-WQF</th>
      <th id="T_7f041_level1_row3" class="row_heading level1 row3" >Power Law</th>
      <td id="T_7f041_row3_col0" class="data row3 col0" >21,274</td>
      <td id="T_7f041_row3_col1" class="data row3 col1" >2.785</td>
      <td id="T_7f041_row3_col2" class="data row3 col2" >2.198</td>
      <td id="T_7f041_row3_col3" class="data row3 col3" >1.027</td>
      <td id="T_7f041_row3_col4" class="data row3 col4" >0.622</td>
      <td id="T_7f041_row3_col5" class="data row3 col5" >0.835</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row4" class="row_heading level1 row4" >Power Law (ERA5-based alpha)</th>
      <td id="T_7f041_row4_col0" class="data row4 col0" >21,232</td>
      <td id="T_7f041_row4_col1" class="data row4 col1" >2.523</td>
      <td id="T_7f041_row4_col2" class="data row4 col2" >1.966</td>
      <td id="T_7f041_row4_col3" class="data row4 col3" >0.133</td>
      <td id="T_7f041_row4_col4" class="data row4 col4" >0.692</td>
      <td id="T_7f041_row4_col5" class="data row4 col5" >0.836</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row5" class="row_heading level1 row5" >Log Law</th>
      <td id="T_7f041_row5_col0" class="data row5 col0" >21,238</td>
      <td id="T_7f041_row5_col1" class="data row5 col1" >2.529</td>
      <td id="T_7f041_row5_col2" class="data row5 col2" >1.973</td>
      <td id="T_7f041_row5_col3" class="data row5 col3" >0.202</td>
      <td id="T_7f041_row5_col4" class="data row5 col4" >0.691</td>
      <td id="T_7f041_row5_col5" class="data row5 col5" >0.836</td>
    </tr>
    <tr>
      <th id="T_7f041_level0_row6" class="row_heading level0 row6" rowspan="3">CCMP</th>
      <th id="T_7f041_level1_row6" class="row_heading level1 row6" >Power Law</th>
      <td id="T_7f041_row6_col0" class="data row6 col0" >21,078</td>
      <td id="T_7f041_row6_col1" class="data row6 col1" >2.964</td>
      <td id="T_7f041_row6_col2" class="data row6 col2" >2.342</td>
      <td id="T_7f041_row6_col3" class="data row6 col3" >1.480</td>
      <td id="T_7f041_row6_col4" class="data row6 col4" >0.526</td>
      <td id="T_7f041_row6_col5" class="data row6 col5" >0.837</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row7" class="row_heading level1 row7" >Power Law (ERA5-based alpha)</th>
      <td id="T_7f041_row7_col0" class="data row7 col0" >21,109</td>
      <td id="T_7f041_row7_col1" class="data row7 col1" >2.531</td>
      <td id="T_7f041_row7_col2" class="data row7 col2" >1.975</td>
      <td id="T_7f041_row7_col3" class="data row7 col3" >0.597</td>
      <td id="T_7f041_row7_col4" class="data row7 col4" >0.664</td>
      <td id="T_7f041_row7_col5" class="data row7 col5" >0.841</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row8" class="row_heading level1 row8" >Log Law</th>
      <td id="T_7f041_row8_col0" class="data row8 col0" >21,104</td>
      <td id="T_7f041_row8_col1" class="data row8 col1" >2.554</td>
      <td id="T_7f041_row8_col2" class="data row8 col2" >1.995</td>
      <td id="T_7f041_row8_col3" class="data row8 col3" >0.665</td>
      <td id="T_7f041_row8_col4" class="data row8 col4" >0.658</td>
      <td id="T_7f041_row8_col5" class="data row8 col5" >0.841</td>
    </tr>
    <tr>
      <th id="T_7f041_level0_row9" class="row_heading level0 row9" rowspan="3">ERA5</th>
      <th id="T_7f041_level1_row9" class="row_heading level1 row9" >Power Law</th>
      <td id="T_7f041_row9_col0" class="data row9 col0" >716,184</td>
      <td id="T_7f041_row9_col1" class="data row9 col1" >2.277</td>
      <td id="T_7f041_row9_col2" class="data row9 col2" >1.748</td>
      <td id="T_7f041_row9_col3" class="data row9 col3" >0.144</td>
      <td id="T_7f041_row9_col4" class="data row9 col4" >0.741</td>
      <td id="T_7f041_row9_col5" class="data row9 col5" >0.866</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row10" class="row_heading level1 row10" >Power Law (ERA5-based alpha)</th>
      <td id="T_7f041_row10_col0" class="data row10 col0" >711,857</td>
      <td id="T_7f041_row10_col1" class="data row10 col1" >1.983</td>
      <td id="T_7f041_row10_col2" class="data row10 col2" >1.453</td>
      <td id="T_7f041_row10_col3" class="data row10 col3" >-0.255</td>
      <td id="T_7f041_row10_col4" class="data row10 col4" >0.803</td>
      <td id="T_7f041_row10_col5" class="data row10 col5" >0.899</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row11" class="row_heading level1 row11" >Log Law</th>
      <td id="T_7f041_row11_col0" class="data row11 col0" >712,940</td>
      <td id="T_7f041_row11_col1" class="data row11 col1" >2.324</td>
      <td id="T_7f041_row11_col2" class="data row11 col2" >1.782</td>
      <td id="T_7f041_row11_col3" class="data row11 col3" >-0.607</td>
      <td id="T_7f041_row11_col4" class="data row11 col4" >0.731</td>
      <td id="T_7f041_row11_col5" class="data row11 col5" >0.866</td>
    </tr>
    <tr>
      <th id="T_7f041_level0_row12" class="row_heading level0 row12" rowspan="3">Sentinel-1</th>
      <th id="T_7f041_level1_row12" class="row_heading level1 row12" >Power Law</th>
      <td id="T_7f041_row12_col0" class="data row12 col0" >2,424</td>
      <td id="T_7f041_row12_col1" class="data row12 col1" >2.813</td>
      <td id="T_7f041_row12_col2" class="data row12 col2" >2.167</td>
      <td id="T_7f041_row12_col3" class="data row12 col3" >-0.306</td>
      <td id="T_7f041_row12_col4" class="data row12 col4" >0.580</td>
      <td id="T_7f041_row12_col5" class="data row12 col5" >0.791</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row13" class="row_heading level1 row13" >Power Law (ERA5-based alpha)</th>
      <td id="T_7f041_row13_col0" class="data row13 col0" >2,410</td>
      <td id="T_7f041_row13_col1" class="data row13 col1" >2.930</td>
      <td id="T_7f041_row13_col2" class="data row13 col2" >2.282</td>
      <td id="T_7f041_row13_col3" class="data row13 col3" >-1.105</td>
      <td id="T_7f041_row13_col4" class="data row13 col4" >0.544</td>
      <td id="T_7f041_row13_col5" class="data row13 col5" >0.791</td>
    </tr>
    <tr>
      <th id="T_7f041_level1_row14" class="row_heading level1 row14" >Log Law</th>
      <td id="T_7f041_row14_col0" class="data row14 col0" >2,410</td>
      <td id="T_7f041_row14_col1" class="data row14 col1" >2.912</td>
      <td id="T_7f041_row14_col2" class="data row14 col2" >2.265</td>
      <td id="T_7f041_row14_col3" class="data row14 col3" >-1.043</td>
      <td id="T_7f041_row14_col4" class="data row14 col4" >0.550</td>
      <td id="T_7f041_row14_col5" class="data row14 col5" >0.791</td>
    </tr>
  </tbody>
</table>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="power-density-estimation">
<h2>Power Density Estimation<a class="headerlink" href="#power-density-estimation" title="Permalink to this headline">¶</a></h2>
<p>Offshore wind power density estimates may be generated for an AOI using the available wind speed values at the corresponding coordinates. When used in combination with wind speed extrapolation as described above, it is possible to estimate power at typical wind turbine hub heights. The following publications provide examples of power density estimation using wind speed:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://doi.org/10.1175/2096.1">Pryor et al. (2004) - Can Satellite Sampling of Offshore Wind Speeds Realistically Represent Wind Speed Distributions? Part II: Quantifying Uncertainties Associated with Distribution Fitting Methods</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1016/j.rse.2015.07.008">Doubrawa et al. (2015) - Satellite winds as a tool for offshore wind resource assessment: The Great Lakes Wind Atlas</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1016/j.rse.2014.09.030">Hasager et al. (2015) - Offshore wind climatology based on synergetic use of Envisat ASAR, ASCAT and QuikSCAT</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1175/JAMC-D-15-0197.1">Badger et al. (2016) - Extrapolating Satellite Winds to Turbine Operating Heights</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1016/j.apenergy.2016.01.135">Shu et al. (2016) - Observations of offshore wind characteristics by Doppler-LiDAR for wind energy applications</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.3390/en12020206">Remmers et al. (2019) - The Potential of Advanced Scatterometer (ASCAT) 12.5 km Coastal Observations for Offshore Wind Farm Site Selection in Irish Waters</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5194/wes-5-1191-2020">Ahsbahs et al. (2020) - US East Coast synthetic aperture radar wind atlas for offshore wind energy</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.5194/wes-5-1023-2020">de Montera et al. (2020) - Validation of Sentinel-1 offshore winds and average wind power estimation around Ireland</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1016/j.rser.2020.110167">Xu et al. (2020) - Proliferation of offshore wind farms in the North Sea and surrounding waters revealed by satellite image time series</a></p></li>
</ul>
<hr class="docutils" />
<section id="estimation-implementation">
<h3>Estimation implementation<a class="headerlink" href="#estimation-implementation" title="Permalink to this headline">¶</a></h3>
<p>Power density estimation at multiple heights is implemented as an <code class="docutils literal notranslate"><span class="pre">Extrapolator</span></code>, as used for wind speed extrapolation above. Here is the base class used for all implementations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PowerDensityEstimator</span><span class="p">(</span><span class="n">Extrapolator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base power density estimator class, implemented as an Extrapolator to reuse the creation of new variables with height dimension&quot;&quot;&quot;</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;long_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Power density (estimated using wind speed)&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;Wm**-2&#39;</span>
                            <span class="p">}</span>
    
    <span class="n">min_wind_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">CUT_IN_WIND_SPEED</span>
    <span class="n">max_wind_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">CUT_OUT_WIND_SPEED</span>
    <span class="n">wind_speed_variable_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;wind_speed&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">air_density</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">1.225</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">air_density</span> <span class="o">=</span> <span class="n">air_density</span>

    <span class="k">def</span> <span class="nf">extrapolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">heights</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">variable_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;power_density&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Estimate power density at required heights&quot;&quot;&quot;</span>
        <span class="n">estimated_power_density</span> <span class="o">=</span> <span class="p">{</span><span class="n">height</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_power_density</span><span class="p">(</span><span class="n">wind_speed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_wind_speed</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_speed_variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)))</span>
                                           <span class="k">for</span> <span class="n">height</span> <span class="ow">in</span> <span class="n">heights</span><span class="p">}</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_extrapolated_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">,</span> <span class="n">estimated_power_density</span><span class="p">,</span> <span class="n">reindex_height</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">variable_attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_filter_wind_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filters to turbine cut in/out range&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">wind_speed</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">wind_speed</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_wind_speed</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wind_speed</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_wind_speed</span><span class="p">))</span>
        
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_estimate_power_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Power density estimation implementation&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="power-density-estimation-using-cubed-wind-speed">
<h3>Power Density Estimation using cubed wind speed<a class="headerlink" href="#power-density-estimation-using-cubed-wind-speed" title="Permalink to this headline">¶</a></h3>
<p>When a data set provides a complete time series of wind speed observations, power density may be estimated from the cube of the wind speed (<a class="reference external" href="https://doi.org/10.5194/wes-5-1023-2020">de Montera et al., 2020</a>):</p>
<p><span class="math notranslate nohighlight">\(P = \dfrac{1}{2}\rho U^3\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P\)</span>: wind power  density (<span class="math notranslate nohighlight">\(W m^{-2}\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\rho\)</span>: air density (<span class="math notranslate nohighlight">\(kg\)</span> <span class="math notranslate nohighlight">\(m^{-3}\)</span>), a default value of 1.225 is typically used over oceans</p></li>
<li><p><span class="math notranslate nohighlight">\(U\)</span>: wind speed (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CubedWindSpeedPowerDensityEstimator</span><span class="p">(</span><span class="n">PowerDensityEstimator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Power density estimation using complete wind speed time series&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_estimate_power_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Power density estimation implementation&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_density</span> <span class="o">*</span> <span class="p">(</span><span class="n">wind_speed</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="aoi-wind-speed-distributions-and-weibull-parameters">
<h3>AOI wind speed distributions and Weibull parameters<a class="headerlink" href="#aoi-wind-speed-distributions-and-weibull-parameters" title="Permalink to this headline">¶</a></h3>
<p>AOI wind speed is typically represented by a Weibull distribution of observations, characterized by a shape parameter (<span class="math notranslate nohighlight">\(k\)</span>, dimensionless) and a scale parameter (<span class="math notranslate nohighlight">\(\lambda\)</span>, <span class="math notranslate nohighlight">\(m s^{-1}\)</span>) (<a class="reference external" href="https://doi.org/10.5194/wes-5-1191-2020">Ahsbahs et al., 2020</a>). The Weibull probability density function (PDF) is as follows:</p>
<p><span class="math notranslate nohighlight">\(\mathrm{PDF}(U) = \dfrac{k}{\lambda}\left(\dfrac{U}{k} \right)^{k-1} \epsilon^{-(U/\lambda)^k}\)</span></p>
<p>A minimum number of observations or samples are required for Weibull parameter fitting, this is relevant for SAR data such as the <a class="reference internal" href="Sentinel-1_ICS_Wind_Data.html"><span class="doc std std-doc">Sentinel-1 data set</span></a>. Consequently, wind speeds from all directional sectors have been used for fitting (<a class="reference external" href="https://doi.org/10.1175/JAMC-D-15-0197.1">Badger et al., 2016</a>), where the same process is applied in this notebook.</p>
<p>Mean wind power density is related to the corresponding Weibull parameters as follows (<a class="reference external" href="https://doi.org/10.5194/wes-5-1191-2020">Ahsbahs et al., 2020</a>):</p>
<p><span class="math notranslate nohighlight">\(P = \dfrac{1}{2}\rho \lambda^3 \Gamma \left(1 + \dfrac{3}{k}\right)\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P\)</span>: wind power density (<span class="math notranslate nohighlight">\(W m^{-2}\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(U\)</span>: wind speed (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\rho\)</span>: air density (<span class="math notranslate nohighlight">\(kg\)</span> <span class="math notranslate nohighlight">\(m^{-3}\)</span>), a default value of 1.225 is typically used over oceans</p></li>
<li><p><span class="math notranslate nohighlight">\(\Gamma\)</span>: gamma function (<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.special.gamma.html"><code class="docutils literal notranslate"><span class="pre">scipy.special.gamma()</span></code></a> is used in this notebook)</p></li>
<li><p><span class="math notranslate nohighlight">\(k\)</span>: Weibull shape parameter (dimensionless)</p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda\)</span>: Weibull scale parameter (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>)</p></li>
</ul>
<p>Using the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.weibull_min.html"><code class="docutils literal notranslate"><span class="pre">scipy.stats.weibull_min()</span></code></a> implementation for Weibull parameter fitting is sufficient for individual AOI assessment. This approach does not scale well, preventing Weibull parameter fitting for all AOI grid coordinates in data sets with high spatial resolutions. However, <a class="reference external" href="https://doi.org/10.1175/1520-0450(1978)017%3C0350:MFEWSF%3E2.0.CO;2">Justus et al., 1976 (Methods for Estimating Wind Speed Frequency Distributions)</a> proposed parameter estimation as follows, which has been used with Sentinel-1 wind speed data (<a class="reference external" href="https://doi.org/10.5194/wes-5-1023-2020">de Montera et al., 2020</a>)</p>
<p><span class="math notranslate nohighlight">\(k = \left(\dfrac{\sigma}{\mu} \right)^{-1.086}\)</span></p>
<p><span class="math notranslate nohighlight">\(\lambda = \dfrac{\mu}{\Gamma \left(\frac{1}{k} + 1 \right)}\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mu\)</span>: mean wind speed (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma\)</span>: wind speed standard deviation (<span class="math notranslate nohighlight">\(m s^{-1}\)</span>)</p></li>
</ul>
<p>This approach can be implemented using xarray’s lazy computation, where the corresponding Dask graph execution does not occur until <code class="docutils literal notranslate"><span class="pre">compute()</span></code> is called, and will scale to accomodate all data sets in the EOOffshore catalog.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WeibullWindSpeedPowerDensityEstimator</span><span class="p">(</span><span class="n">PowerDensityEstimator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Power density estimation using Weibull parameters&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_filter_wind_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Filters to turbine cut in/out range&quot;&quot;&quot;</span>
        <span class="c1"># No filtering is performed prior to Weibull parameter fitting</span>
        <span class="k">return</span> <span class="n">wind_speed</span>

    <span class="k">def</span> <span class="nf">_estimate_power_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Power density estimation implementation&quot;&quot;&quot;</span>
        <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">air_density</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">shape</span><span class="p">))</span>        

    <span class="k">def</span> <span class="nf">fit_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Fit Weibull parameters&quot;&quot;&quot;</span>
        <span class="c1"># As  used in de Montera et al., 2020</span>
        <span class="n">mean_wind_speed</span> <span class="o">=</span> <span class="n">wind_speed</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">wind_speed</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">mean_wind_speed</span><span class="p">)</span><span class="o">**-</span><span class="mf">1.086</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">mean_wind_speed</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">shape</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="power-density-comparison">
<h2>Power Density Comparison<a class="headerlink" href="#power-density-comparison" title="Permalink to this headline">¶</a></h2>
<p>In contrast to the previous section that compares IWB buoy data with corresponding satellite and reanalysis Zarr stores contained in the EOOffshore catalog, the remainder of this notebook focuses on comparisons between the Zarr stores. The approach is as follows:</p>
<ol class="simple">
<li><p>Select a <em>reference</em> data set (analagous to the role of IWB data in the previous section).</p></li>
<li><p>Select one or more <em>test</em> data sets.</p></li>
<li><p>Select AOI subsets of the <em>reference</em> and <em>test</em> data sets, using IWB buoy and wind farm coordinates, and the <code class="docutils literal notranslate"><span class="pre">time</span></code> dimension.</p></li>
<li><p>Calculate metrics for each <em>reference</em>-<em>test</em> data set comparison, and generate corresponding density scatter plots, for the specified variable/height parameters.</p></li>
</ol>
<p>Comparison of power density estimates is similar to the previous approach used with wind speed comparison. The NEWA Zarr stores is used as the <em>reference</em> data set, as it is the sole data set that provides power density at multiple heights above the surface. As before, this is not strictly considered as a <em>ground truth</em> data set, and may be substituted by a future data set containing wind power measurements at multiple heights with high spatial coverage.</p>
<p>In the case of data sets where the Weibull parameters are used to estimate power density, a time series will not be available. Consequently, mean power estimate bias, in percentage, as defined by <a class="reference external" href="https://doi.org/10.5194/gmd-13-5079-2020">Dörenkämper et al. (2020) - The Making of the New European Wind Atlas – Part 2: Production and Evaluation</a>, is the sole metric used for wind power comparisons:</p>
<p><span class="math notranslate nohighlight">\(\overline{P}_{Bias} = 100 \times \dfrac{\overline{\hat{P}} - \overline{P}}{\overline{P}}\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\overline{P}\)</span>: mean reference (true) power density, e.g. NEWA power density for AOI grid coordinates</p></li>
<li><p><span class="math notranslate nohighlight">\(\overline{\hat{P}}\)</span>: mean test (predicted) power density, e.g. corresponding power density estimated from ERA5 wind speed for AOI grid coordinates</p></li>
</ul>
<p>Mean power density may be estimated using either the cubed wind speed or Weibull methods. These classes implement reference and test data set power comparison, enabling AOI subset matching, metrics calculation, and box plot generation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AoiPowerDensityTestDataset</span><span class="p">(</span><span class="n">AoiWindSpeedTestDataset</span><span class="p">):</span>
    <span class="n">estimator</span><span class="p">:</span> <span class="n">PowerDensityEstimator</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AoiPowerDensityMetrics</span><span class="p">(</span><span class="n">AoiWindSpeedMetrics</span><span class="p">):</span>
    <span class="n">test_datasets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AoiPowerDensityTestDataset</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;power_density&#39;</span> 
    <span class="n">variable_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">16</span> <span class="c1"># min power based on CUT_IN_WIND_SPEED</span>
    <span class="n">variable_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">9640</span> <span class="c1"># max power based on CUT_OUT_WIND_SPEED</span>
    <span class="n">discard_matches</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pbias_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;$\overline</span><span class="si">{P}</span><span class="s1">_</span><span class="si">{Bias}</span><span class="s1">$&#39;</span>

    <span class="k">def</span> <span class="nf">_init_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Power density estimation using extrapolated wind speed&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_init_variables</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">test_dataset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_datasets</span><span class="p">:</span>
            <span class="n">test_dataset</span><span class="o">.</span><span class="n">eooffshore_dataset</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">extrapolate</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">eooffshore_dataset</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> 
                                                                                         <span class="n">heights</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison_height</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_match_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_comparison</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Match datasets, using time if available&quot;&quot;&quot;</span>
        <span class="c1"># Mean power density is used for comparison, as certain test datasets won&#39;t have time dimension</span>
        <span class="c1"># for power density variable (e.g. those that are Weibull-based)</span>
        <span class="c1"># The wind speed variable is used for time matching as it will always have a time dimension</span>
        <span class="c1"># The matched times are used to select the corresponding power density as required        </span>
        <span class="n">reference_windspeed_variable</span><span class="p">,</span> <span class="n">test_windspeed_variable</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_match_variables</span><span class="p">(</span><span class="n">dataset_comparison</span><span class="p">,</span> <span class="s1">&#39;wind_speed&#39;</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">match_power_density</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">windspeed_variable</span><span class="p">):</span>
            <span class="n">power_density</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comparison_height</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">power_density</span><span class="o">.</span><span class="n">dims</span><span class="p">:</span>
                <span class="n">power_density</span> <span class="o">=</span> <span class="n">power_density</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">windspeed_variable</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">power_density</span>
            
        <span class="n">reference_variable</span> <span class="o">=</span> <span class="n">match_power_density</span><span class="p">(</span><span class="n">dataset_comparison</span><span class="o">.</span><span class="n">referenceds</span><span class="p">,</span> <span class="n">reference_windspeed_variable</span><span class="p">)</span>
        <span class="n">test_variable</span> <span class="o">=</span> <span class="n">match_power_density</span><span class="p">(</span><span class="n">dataset_comparison</span><span class="o">.</span><span class="n">testds</span><span class="p">,</span> <span class="n">test_windspeed_variable</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">reference_variable</span><span class="p">,</span> <span class="n">test_variable</span>


    <span class="k">def</span> <span class="nf">calculate_percentage_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Power comparison metric&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">)</span><span class="o">/</span><span class="n">y_true</span>

    <span class="k">def</span> <span class="nf">_calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate comparison metrics using true (reference) and predicted (test) values&quot;&quot;&quot;</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;$n$&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="s1">&#39;Bias&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">),</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">pbias_label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_percentage_bias</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
                  <span class="p">}</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_comparison_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a box plot containing data set percentage bias distributions&quot;&quot;&quot;</span>
        <span class="c1"># Single plot illustrating percentage bias distribution per test dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pbias_label</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_percentage_bias</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span><span class="o">.</span><span class="n">NEWA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span><span class="o">.</span><span class="n">Test</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">matchesdf</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pbias_label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{self.reference_name}</span><span class="s1"> </span><span class="si">{self.comparison_height}</span><span class="s1">m {self.variable.replace(&quot;_&quot;, &quot; &quot;)} (IWB buoy, wind farm AOIs)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<section id="newa-150m-power-density">
<h3>NEWA 150m power density<a class="headerlink" href="#newa-150m-power-density" title="Permalink to this headline">¶</a></h3>
<p>10m wind speed is extrapolated and used to estimate power density, which is compared with the corresponding NEWA 150m power density at the IWB buoy and wind farm AOI coordinates. Each data set is extrapolated as follows, based on the previous metrics tables obtained from MÉRA and NEWA wind speed comparisons:</p>
<ul class="simple">
<li><p>ASCAT-NRT/REP: Power Law (ERA5-based alpha)</p></li>
<li><p>CCMP: Power Law (ERA5-based alpha)</p></li>
<li><p>ERA5: Power Law (ERA5-based alpha)</p></li>
<li><p>Sentinel-1: Power Law with default <span class="math notranslate nohighlight">\(\alpha\)</span> = 0.11</p></li>
</ul>
<p>As NEWA also provides an air density variable (<code class="docutils literal notranslate"><span class="pre">RHO</span></code>), its mean value will be used for estimation instead of the default value of 1.225 that is typically used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newa_rhodf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;RHO&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">dataset</span><span class="o">.</span><span class="n">RHO</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="p">{</span><span class="n">ds</span><span class="o">.</span><span class="n">dataset_id</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">dataset</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">newa</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span><span class="o">.</span><span class="n">values</span><span class="p">()]})</span>
<span class="n">newa_rhodf</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RHO</th>
      <td>4.0</td>
      <td>1.233518</td>
      <td>0.000991</td>
      <td>1.2326</td>
      <td>1.232793</td>
      <td>1.233351</td>
      <td>1.234075</td>
      <td>1.234769</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cubed_windspeed_estimator</span> <span class="o">=</span> <span class="n">CubedWindSpeedPowerDensityEstimator</span><span class="p">(</span><span class="n">air_density</span><span class="o">=</span><span class="n">newa_rhodf</span><span class="o">.</span><span class="n">RHO</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">weibull_power_estimator</span> <span class="o">=</span> <span class="n">WeibullWindSpeedPowerDensityEstimator</span><span class="p">(</span><span class="n">air_density</span><span class="o">=</span><span class="n">newa_rhodf</span><span class="o">.</span><span class="n">RHO</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">test_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">AoiPowerDensityTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatall</span><span class="p">,</span> 
                                            <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">,</span> 
                                            <span class="n">estimator</span><span class="o">=</span><span class="n">cubed_windspeed_estimator</span><span class="p">),</span>
                 <span class="n">AoiPowerDensityTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ascatwqf</span><span class="p">,</span> 
                                            <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">,</span> 
                                            <span class="n">estimator</span><span class="o">=</span><span class="n">weibull_power_estimator</span><span class="p">),</span>
                 <span class="n">AoiPowerDensityTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">ccmp</span><span class="p">,</span> 
                                            <span class="n">extrapolator</span><span class="o">=</span><span class="n">mean_era5_alpha_powerlaw_extrapolator</span><span class="p">,</span> 
                                            <span class="n">estimator</span><span class="o">=</span><span class="n">cubed_windspeed_estimator</span><span class="p">),</span>
                 <span class="n">AoiPowerDensityTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">era5</span><span class="p">,</span> 
                                            <span class="n">extrapolator</span><span class="o">=</span><span class="n">era5_alpha_powerlaw_extrapolator</span><span class="p">,</span> 
                                            <span class="n">estimator</span><span class="o">=</span><span class="n">cubed_windspeed_estimator</span><span class="p">),</span>
                 <span class="n">AoiPowerDensityTestDataset</span><span class="p">(</span><span class="n">eooffshore_dataset</span><span class="o">=</span><span class="n">sentinel1</span><span class="p">,</span> 
                                            <span class="n">extrapolator</span><span class="o">=</span><span class="n">powerlaw_extrapolator</span><span class="p">,</span> 
                                            <span class="n">estimator</span><span class="o">=</span><span class="n">weibull_power_estimator</span><span class="p">)</span>
                <span class="p">]</span>

<span class="n">AoiPowerDensityMetrics</span><span class="p">(</span><span class="n">reference_dataset</span><span class="o">=</span><span class="n">newa</span><span class="p">,</span>
                       <span class="n">test_datasets</span><span class="o">=</span><span class="n">test_datasets</span><span class="p">,</span>
                       <span class="n">comparison_height</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                       <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Cubed Wind Speed/Weibull&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_4c519">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_4c519_level0_col0" class="col_heading level0 col0" >$n$</th>
      <th id="T_4c519_level0_col1" class="col_heading level0 col1" >Bias</th>
      <th id="T_4c519_level0_col2" class="col_heading level0 col2" >$\overline{P}_{Bias}$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_4c519_level0_row0" class="row_heading level0 row0" >ASCAT-ALL</th>
      <td id="T_4c519_row0_col0" class="data row0 col0" >&nbsp;9</td>
      <td id="T_4c519_row0_col1" class="data row0 col1" >&nbsp;-36.525</td>
      <td id="T_4c519_row0_col2" class="data row0 col2" >&nbsp;-3.026</td>
    </tr>
    <tr>
      <th id="T_4c519_level0_row1" class="row_heading level0 row1" >ASCAT-WQF</th>
      <td id="T_4c519_row1_col0" class="data row1 col0" >&nbsp;6</td>
      <td id="T_4c519_row1_col1" class="data row1 col1" >&nbsp;-29.087</td>
      <td id="T_4c519_row1_col2" class="data row1 col2" >&nbsp;-2.570</td>
    </tr>
    <tr>
      <th id="T_4c519_level0_row2" class="row_heading level0 row2" >CCMP</th>
      <td id="T_4c519_row2_col0" class="data row2 col0" >&nbsp;9</td>
      <td id="T_4c519_row2_col1" class="data row2 col1" >&nbsp;131.221</td>
      <td id="T_4c519_row2_col2" class="data row2 col2" >&nbsp;12.967</td>
    </tr>
    <tr>
      <th id="T_4c519_level0_row3" class="row_heading level0 row3" >ERA5</th>
      <td id="T_4c519_row3_col0" class="data row3 col0" >&nbsp;9</td>
      <td id="T_4c519_row3_col1" class="data row3 col1" >&nbsp;-84.781</td>
      <td id="T_4c519_row3_col2" class="data row3 col2" >&nbsp;-8.305</td>
    </tr>
    <tr>
      <th id="T_4c519_level0_row4" class="row_heading level0 row4" >Sentinel-1</th>
      <td id="T_4c519_row4_col0" class="data row4 col0" >&nbsp;9</td>
      <td id="T_4c519_row4_col1" class="data row4 col1" >&nbsp;85.333</td>
      <td id="T_4c519_row4_col2" class="data row4 col2" >&nbsp;6.872</td>
    </tr>
  </tbody>
</table>
</div><img alt="_images/Comparison_Wind_Power_83_1.png" src="_images/Comparison_Wind_Power_83_1.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="Offshore_Wind_AOI.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Offshore Wind in Irish Areas Of Interest</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="windatlas.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Wind Atlas Development</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Earth Observation Offshore <a href="https://www.twitter.com/EOOffshore" target="_blank">@EOOffshore</a><br/>
    
        &copy; Copyright 2020-2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>